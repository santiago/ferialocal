{"ts":1352792457079,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*\n *  @module Shop\n *  @exports function\n *\n */\ndefine(function() {\nreturn function(app) {\n    var Shop = app.Shop;\n    \n    /*  @Model Offering\n     *\n     */\n    var Shop = Backbone.Model.extend({\n        idAttribute: '_id',\n        urlRoot: '/shops'\n    });\n\n    /*  @Model Comment\n     *\n     */\n    var Comment = Backbone.Model.extend({\n        idAttribute: '_id'\n    });\n\n    /*  @Collection OfferingList\n     *\n     */\n    var ShopList = Backbone.Collection.extend({\n        model: Shop,\n        url: '/shops'\n    });\n    \n\n    /*  @Collection CommentList\n     *\n     */\n    var CommentList = Backbone.Collection.extend({\n        model: Point\n    });\n\n\n    /*  @View PublishView\n     *\n     */\n    var el = $('section#publish').get();\n    var PublishView = new Backbone.View.extend({\n        el: el,\n\n        events: {\n            \"click a#publish-btn\": \"publish\",\n        },\n\n        initialize: function() {\n        },\n        \n        publish: function() {\n            var data = PublishForm.getValidData();\n            if (data) {\n                this.collection.create(data);\n            }\n        }\n    });\n    \n    var Publish = new PublishView({\n        collection: new ShopList\n    });\n\n\n    /*  @View MyMappingsView\n     *\n     */\n    var el = $('#mis-mapas').get();\n    var MyMappingsView = Backbone.View.extend({\n        el: el,\n\n        events: {\n            \"click button#addmap\": \"openNewMap\",\n            \"keypress input\": \"captureKey\",\n            \"click #newmap .close\": \"closeNewMap\",\n            \"click button#savemap\": \"createMapping\"\n        },\n\n        initialize: function() {\n            var view = this;\n            this.render();\n            $(window).on('keydown', function(e) {\n                if (e.keyCode == 27) {\n                    view.closeNewMap();\n                }\n            });\n\n            this.collection.on('sync', function(e, f) {\n                view.render();\n                view.closeNewMap();\n                location.hash = \"#mapping/\"+e.id;\n            });\n        },\n\n        render: function() {\n            this.collection.fetch({\n                data: {\n                    user_id: this.user_id\n                },\n                success: function(coll, data) {\n                    $('ul.mappings').empty();\n                    data.forEach(function(item) {\n                        item.id = item._id;\n                        dust.render('mapping_item', item, function(err, html) {\n                            $('ul.mappings').append(html);\n                        });\n                    });\n                }\n            });\n        },\n\n        openNewMap: function() {\n            $('#newmap').slideDown('fast', function() {\n                // $('#newmap .close').show()\n            });\n            $('.overlay').fadeIn('fast');\n            $('#newmap input').focus();\n            $('button#addmap').fadeOut('fast');\n        },\n\n        closeNewMap: function() {\n            $('#newmap').slideUp('fast', function() {\n                // $('#newmap .close').hide()\n            });\n            $('.overlay').fadeOut('fast');\n            $('button#addmap').fadeIn('fast');\n        },\n\n        createMapping: function() {\n            var title = $.trim($('#newmap input').val());\n            if (!title) {\n                return false\n            }\n            this.collection.create({\n                title: title\n            });\n        },\n\n        captureKey: function(e) {\n            switch (e.keyCode) {\n            case 13:\n                this.createMapping();\n                break;\n            default:\n                break;\n            }\n        }\n    });\n\n    var View = new MyMappingsView({\n        collection: new MappingList\n    });\n\n    /*  @View MappingView\n     *\n     */\n    var MappingView = new (Backbone.View.extend({        \n        initialize: function() {\n            var view = this;\n            \n            this.points = new PointList;\n            this.points.on('sync', function(e) {\n                this.closeNewPoint();\n                this.refresh(onRefresh);\n                function onRefresh() {\n                    $('.rslide-card.mapping').addClass('active')\n                }\n            }.bind(this));\n        },\n\n        events: {\n            \"click button#addpoint\": \"openNewPoint\",\n            \"click #newpoint .close\": \"closeNewPoint\",\n            \"click #newpoint #mappoint\": \"startPointing\",\n            \"click #newpoint #savepoint\": \"savePoint\",\n            \"click button#editmap\": \"showEdit\",\n            \"click button#savemap\": \"updateMap\",\n            \"click button#deletemap\": \"deleteMap\"\n        },\n        \n        setMapping: function(model, data) {\n            this.id = model.id;\n            this.model = model;\n            this.points.url = '/mappings/'+this.id+'/points';\n            app.setMappingName(this.model.get('title'));\n        },\n        \n        getMappingById: function(id, callback) {\n            var view = this;\n            var mapping = new Mapping({ _id: id });\n            mapping.fetch({\n                success: function(model, data) {\n                    view.setMapping(model, data)\n                    callback(model);\n                }\n            });\n        },\n        \n        load: function(id) {       \n            this.getMappingById(id, function() {\n                this.render();\n                app.CardSlider.show('mapping');\n            }.bind(this))\n        },\n        \n        render: function() {\n            var view = this;\n            \n            this.__lastPoint = null;\n            this._newPointMarker = null;\n\n            var mapping = this.model.toJSON();\n            $('.rslide-card.mapping').remove();\n            dust.render('mapping', mapping, function(err, html) {\n                $('.rslide-card:last').after(html);                \n                view.setElement($('.rslide-card.mapping').get());\n            });\n            this.renderPoints();\n        },\n        \n        renderPoints: function() {\n            var view = this;\n\n            // Clear current state\n            this.$el.find('ul.points li').remove();\n            Map.clearPoints();\n\n            // Render Points\n            var mapping = this.model.toJSON();\n            mapping.points.forEach(function(point) {\n                view.renderPointLabel(point);\n                dust.render('point_item', point, function(err, html) {\n                    var $li = $('<li/>');\n                    $li.html(html);\n                    view.$el.find('ul.points').append($li);\n                });\n            });\n        },\n        \n        renderPointLabel: function(data) {\n            var point = new OpenLayers.LonLat(data.loc[1], data.loc[0]);\n            point.transform(\n                new OpenLayers.Projection(\"EPSG:4326\"),\n                new OpenLayers.Projection(\"EPSG:900913\")\n            );\n            Map.addMarker(point);\n        \n            // Position label\n            var popupPoint = new OpenLayers.LonLat(point.lon + 10, point.lat + 40);\n            this.popup(popupPoint, data._id, data.title);\n        },\n        \n        refresh: function(callback) {\n            var view = this;\n            this.model.fetch({\n                success: function() {\n                    view.render();\n                    callback(view.model);\n                }\n            });\n        },\n        \n        showEdit: function() {\n        },\n        \n        updateMap: function() {\n            var title = $.trim($('[name=title]').val());\n            var description = $.trim($('[name=description]').val());\n            var tags = $.trim($('[name=tags]').val());\n            \n            if(title) {\n                this.model.set('title', $('[name=title]'));\n                this.model.set('description');\n                this.model.set('tags');\n                \n                this.model.save();\n            }\n        },\n        \n        deleteMap: function() {\n            if (confirm('¿Está seguro que desea borrar este mapa?')) {\n                this.model.destroy();\n                location.href = '#mappings'\n            }\n        },\n        \n        /* Display dialog for adding a new Point\n         * to this Mapping\n         *\n         */\n        openNewPoint: function() {\n            $('#newpoint').slideDown();\n            $('button#addpoint').fadeOut('fast');\n        },\n        \n        closeNewPoint: function() {\n            $('#newpoint').slideUp(go.bind(this));\n            $('#newpoint').find('input, textarea').val('');\n            $('button#addpoint').fadeIn('fast');\n            function go() {\n                this.$el.find('#newpoint .info.pointing').find('.one, .two').show();\n                this.$el.find('#newpoint #mappoint').show();\n                this.$el.find('#newpoint .info.pointing').find('.three').hide();\n                this.$el.find('#newpoint .info.pointing').hide();\n                this.$el.find('#newpoint #savepoint').hide();  \n            }\n        },\n        \n        startPointing: function() {\n            var view = this;\n            this.$el.find('#newpoint #mappoint').fadeOut(function() {\n                view.$el.find('#newpoint .info.pointing').fadeIn();\n            });\n            Map.startPointing();\n            Map.map.events.register('click', this, this.__onClickMap);\n        },\n        \n        stopPointing: function() {\n            this.$el.find('#newpoint .info.pointing').find('.one, .two').hide();\n            this.$el.find('#newpoint .info.pointing').find('.three').show();\n            this.$el.find('#newpoint #savepoint').fadeIn();\n            Map.map.events.unregister('click', this, this.__onClickMap);\n            this._newPointMarker.events.register('click', this, this.__onClickNewPointMarker);\n        },\n\n        savePoint: function() {\n            PointForm.setElement(this.$el.find('#newpoint'));\n            var data = PointForm.getValidData();\n            if(data) {\n                data.mapping_id = this.id;\n                this.points.create(data);\n                this._newPointMarker.events.unregister('click', this, this.__onClickNewPointMarker);\n                Map.map.events.unregister('click', this, this.__onClickMap);\n                \n                // Place definite marker\n                Map.addMarker(this.__lastPoint);\n                this._newPointMarker = null;\n            }\n        },\n\n        popup: function(point, id, text) {\n            var popup = new OpenLayers.Popup('pointlabel-'+id, // Label\n                point, // Point\n                new OpenLayers.Size(text.length * 8, 15), // Size\n                text, // Text\n                true\n            );\n            \n            Map.map.addPopup(popup);\n            \n             // Style label\n            var $nodeLabel = $(\"#pointlabel-\" + id);\n            $nodeLabel.addClass(\"pointlabel\");\n            $nodeLabel.css({\n                border: \"2px solid #666\"\n            });\n            $nodeLabel.find('#pointlabel-' + id + '_close').remove();\n\n            // on mouse over label\n            $nodeLabel.on('mouseover', function(e) {\n            $nodeLabel.addClass('hover');\n            $nodeLabel.css({\n                border: \"2px solid blue\"\n                });\n            });\n\n            // on mouse out label\n            $nodeLabel.on('mouseout', function(e) {\n               $nodeLabel.removeClass('hover');\n                $nodeLabel.css({\n                    border: \"2px solid #666\"\n                });\n            });\n        },\n\n        __onClickNewPointMarker: function(e) {\n            this._newPointMarker.events.unregister('click', this, this.__onClickNewPointMarker);\n            Map.map.events.unregister('click', this, this.__onClickMap);\n            this.startPointing();\n        },\n        \n        __onClickMap: function(e) {\n            // Get Point from Event\n            var point = Map.map.getLonLatFromViewPortPx(e.xy);\n            this.__lastPoint = point.clone();\n            \n            this._newPointMarker = Map.getMarker(point);\n\n            point.transform(\n                new OpenLayers.Projection(\"EPSG:900913\"),\n                new OpenLayers.Projection(\"EPSG:4326\")\n            );\n            this.$el.find('#newpoint input[name=lat]').val(point.lat);\n            this.$el.find('#newpoint input[name=lon]').val(point.lon);\n\n            this.stopPointing();\n        }\n    }));\n    \n    var MediaGallery = new (Backbone.View.extend({\n        initialize: function() {\n            var view = this;\n            dust.render('media_gallery', {}, function(err, html) {\n                $('.root-wrapper').append(html)\n                go();\n            });\n            \n            function go() {\n                Galleria.loadTheme('/javascripts/thirdparty/galleria/themes/classic/galleria.classic.min.js');\n                Galleria.ready(function() {\n                    $('#galleria-wrapper').overlay({\n                        fixed: false,\n                        top: 32\n                    });\n                    view.galleria = Galleria.get(0);\n                });\n                // Galleria.run('#galleria', { dataSource: [{image:'/images/ajax_loader_big.gif'}] });\n            }\n        },\n        \n        load: function(data) {\n            $('#galleria-wrapper').fadeIn(function() {\n                this.galleria.load(data);\n            }.bind(this))\n        }\n    }));\n    \n    var PointView = new (Backbone.View.extend({\n        events: {\n            'click #addphoto': 'addPhoto'\n        },\n\n        initialize: function() {\n        },\n        \n        getPointById: function(mapping_id, point_id, callback) {\n            var view = this;\n            \n            this.mapping_id = mapping_id;\n            this.point_id = point_id;\n            \n            MappingView.getMappingById(mapping_id, function(mapping) {\n                view.point = _.find(mapping.get('points'), function(p) {\n                    return p._id == point_id\n                });\n                MappingView.renderPoints();\n                view.render(callback);\n            });\n        },\n        \n        render: function(callback) {\n            var view = this;\n\n            dust.render('point', this.point, function(err, html) {\n                // Remove existing data\n                $('.rslide-card.point').remove();\n                \n                $('.rslide-card:last').after(html);\n                view.setElement($('.rslide-card.point').get());\n                \n                // Setup photo upload\n                view.photoUpload();\n                \n                // Hide file input\n                var wrapper = $('<div/>').css({height:0,width:0,'overflow':'hidden'});\n                var fileInput = $(':file').wrap(wrapper);\n                fileInput.change(function(){\n                    var $this = $(this);\n                    $('#file').text($this.val());\n                });\n                // Tell the world you've finished rendering\n                if(typeof callback == 'function') callback();\n            });\n            \n            if (this.point.image.length === 0) {\n                this.$el.find('.media-image a.show').remove();\n            }\n            \n            this.mediaGallery();\n        },\n        \n        addPhoto: function() {\n            $('.media-image :file').click();\n        },\n        \n        photoUpload: function() {\n            var view = this;\n            \n            this.$el.find('.image-upload .control a').click(function(e) {\n                e.preventDefault();\n                $(this).blur();\n                \n                if ($(this).hasClass('cancel')) {\n                    view.cancelUpload();\n                }\n                if ($(this).hasClass('skip')) {\n                    view.skipCurrentUpload();\n                }\n            });\n            \n            $(\"#upload\").html5_upload({\n                url: '/mappings/'+this.mapping_id+'/points/'+this.point_id+'/image',\n                sendBoundary: window.FormData || $.browser.mozilla,\n                onStart: function(event, total) {\n                    // view.__progress = 0;\n                    //$('.meter > span').width(0);\n                    //$('.meter > span').removeClass('stop')\n                    \n                    var check = confirm(\"Está subiendo un total de \" + total + \" imágenes. ¿Desea continuar?\");\n                    if (check) {\n                        $('.image-upload').find('.control p span.index').text(' 1');\n                        $('.image-upload').find('.control p span.total').text(total);\n                        $('#addphoto').fadeOut(function() {\n                            $('.image-upload').slideDown();\n                        });\n                    }\n                    return check;\n                },\n                onStartOne: function(event, name, number, total) {\n                    view.__progress = 0;\n                    view.__uploading = true;\n                    $('.meter > span').removeClass('stop');\n                    $('.image-upload').find('.control p span.index').text(' ' + (number + 1));\n                    view.startProgressBar();\n                    return true;\n                },\n                onProgress: function(event, progress, name, number, total) {\n                    view.__progress = parseFloat((progress*100).toString().slice(0,5));\n                },\n                onFinish: function(event, response, name, number, total) {\n                    $('#addphoto').fadeIn();\n                    $('.image-upload').slideUp(function() {\n                        view.refresh()\n                    });\n                    view.__uploading = false;\n                },\n                onError: function(event, name, error) {\n                    alert('error while uploading file ' + name);\n                }\n            })\n        },\n        \n        refresh: function() {\n            var view = this;\n            MappingView.refresh(function(mapping) {\n                view.point = _.find(mapping.get('points'), function(p) {\n                    return p._id == view.point_id\n                });\n\n                view.render();\n                view.show();\n            });\n        },\n        \n        show: function() {\n            this.$el.addClass('active');\n        },\n        \n        cancelUpload: function() {\n            var view = this;\n\n            $('.media-image #upload:first').triggerHandler('html5_upload.cancelAll');\n            $('.image-upload')\n                .find('.meter > span').addClass('stop')\n                  .end()\n                .find('.control').hide()\n                  .end()\n                .find('.cancel-info').show()\n                \n            setTimeout(function() {\n                view.closeImageUpload();\n            }, 1500);\n        },\n        \n        showImageUpload: function() {\n            $('.image-upload').slideDown();\n            $('#addphoto').fadeOut();\n        },\n        \n        closeImageUpload: function() {\n            $('.image-upload').slideUp(function() {\n                $(this)\n                    .find('.meter > span').removeClass('stop')\n                        .end()\n                    .find('.control').show()\n                        .end()\n                    .find('.cancel-info').hide()\n                    \n                $('#addphoto').fadeIn();\n            });\n        },\n        \n        skipCurrentUpload: function() {\n            var view = this;\n            $('.image-upload')\n                .find('.meter > span').addClass('stop')\n            this.__uploading = false;\n            setTimeout(function() {\n                var current = $.trim($('.image-upload .control .index').text());\n                var total = $.trim($('.image-upload .control .total').text());\n                if (current === total)\n                    view.cancelUpload()\n                else\n                    $('.media-image #upload:first').triggerHandler('html5_upload.cancelOne')\n            }, 101);\n        },\n        \n        startProgressBar: function() {\n            $('.meter > span').width(0);\n            $('.meter > span').removeClass('stop')\n\n            var view = this;\n            function go() {\n                var w = view.__progress + '%';\n                if (/*view.__progress == 100 || */!view.__uploading) { return }\n                $(\".meter > span\").animate({\n                    width: w\n                }, 100, go);\n            }\n            go()\n        },\n        \n        mediaGallery: function() {\n            // $('#galleria').empty();\n            // MediaGallery.load([{ image: '/images/ajax_loader_big.gif' }]);\n            var GalleriaData = this.point.image.map(function(img) {\n                return {\n                    thumb: 'https://s3.amazonaws.com/ow-mapping/200-'+img,\n                    image: 'https://s3.amazonaws.com/ow-mapping/'+img\n                }\n            });\n\n            // Links for launching Media Gallery\n            this.$el.find('#media a.show').click(function(e) {\n                e.preventDefault();\n                $(this).blur()\n                \n                if ($(this).closest('li').hasClass('media-image')) {\n                    $('#galleria-wrapper').css({'z-index':1});\n                    MediaGallery.load(GalleriaData);\n                    if(!$('#galleria-wrapper').overlay().isOpened()) {\n                        $('#galleria-wrapper').overlay().load();\n                    }\n                }\n                \n            });\n        }\n    }));\n    \n    // Backbone Router for Mappings\n    var MappingRouter = Backbone.Router.extend({\n        routes: {\n            \"mapping/:id\": \"getMappingById\",\n            \"mappings/:mapping_id/points/:point_id\": \"getPointById\",\n            \"mappings\": \"getMyMappings\"\n        },\n        getMappingById: function(id) {\n            MappingView.load(id);\n        },\n        getMyMappings: function() {\n            app.CardSlider.show('mis-mapas');\n        },\n        getPointById: function(mapping_id, point_id) {\n            PointView.getPointById(mapping_id, point_id, function() {\n                app.CardSlider.show('point');\n            })\n        }\n    });\n    new MappingRouter();\n\n    \n    // Detect Geolocation\n    function success(pos) {\n        var position = [pos.coords.latitude, pos.coords.longitude];\n        var point = new OpenLayers.LonLat(position[1], position[0]).transform(new OpenLayers.Projection(\"EPSG:4326\"), Map.map.getProjectionObject());\n        Map.map.setCenter(point, 16);\n    }\n\n    function error() {}\n\n    if (navigator.geolocation) {\n        navigator.geolocation.getCurrentPosition(success, error);\n    } else {\n        alert('Geolocation not supported');\n        return;\n    }\n}\n});"]],"start1":0,"start2":0,"length1":0,"length2":22652}]],"length":22652}
{"contributors":[],"silentsave":false,"ts":1352792470170,"patch":[[{"diffs":[[0," model: "],[-1,"Poi"],[1,"Comme"],[0,"nt\n    }"]],"start1":637,"start2":637,"length1":19,"length2":21}]],"length":22654,"saved":false}
{"ts":1352792578749,"patch":[[{"diffs":[[0,";\n\n\n"],[-1,"    /*  @View MyMappingsView\n     *\n     */\n    var el = $('#mis-mapas').get();\n    var MyMappingsView = Backbone.View.extend({\n        el: el,\n\n        events: {\n            \"click button#addmap\": \"openNewMap\",\n            \"keypress input\": \"captureKey\",\n            \"click #newmap .close\": \"closeNewMap\",\n            \"click button#savemap\": \"createMapping\"\n        },\n\n        initialize: function() {\n            var view = this;\n            this.render();\n            $(window).on('keydown', function(e) {\n                if (e.keyCode == 27) {\n                    view.closeNewMap();\n                }\n            });\n\n            this.collection.on('sync', function(e, f) {\n                view.render();\n                view.closeNewMap();\n                location.hash = \"#mapping/\"+e.id;\n            });\n        },\n\n        render: function() {\n            this.collection.fetch({\n                data: {\n                    user_id: this.user_id\n                },\n                success: function(coll, data) {\n                    $('ul.mappings').empty();\n                    data.forEach(function(item) {\n                        item.id = item._id;\n                        dust.render('mapping_item', item, function(err, html) {\n                            $('ul.mappings').append(html);\n                        });\n                    });\n                }\n            });\n        },\n\n        openNewMap: function() {\n            $('#newmap').slideDown('fast', function() {\n                // $('#newmap .close').show()\n            });\n            $('.overlay').fadeIn('fast');\n            $('#newmap input').focus();\n            $('button#addmap').fadeOut('fast');\n        },\n\n        closeNewMap: function() {\n            $('#newmap').slideUp('fast', function() {\n                // $('#newmap .close').hide()\n            });\n            $('.overlay').fadeOut('fast');\n            $('button#addmap').fadeIn('fast');\n        },\n\n        createMapping: function() {\n            var title = $.trim($('#newmap input').val());\n            if (!title) {\n                return false\n            }\n            this.collection.create({\n                title: title\n            });\n        },\n\n        captureKey: function(e) {\n            switch (e.keyCode) {\n            case 13:\n                this.createMapping();\n                break;\n            default:\n                break;\n            }\n        }\n    });\n\n    var View = new MyMappingsView({\n        collection: new MappingList\n    });\n\n    /*  @View MappingView\n     *\n     */\n    var MappingView = new (Backbone.View.extend({        \n        initialize: function() {\n            var view = this;\n            \n            this.points = new PointList;\n            this.points.on('sync', function(e) {\n                this.closeNewPoint();\n                this.refresh(onRefresh);\n                function onRefresh() {\n                    $('.rslide-card.mapping').addClass('active')\n                }\n            }.bind(this));\n        },\n\n        events: {\n            \"click button#addpoint\": \"openNewPoint\",\n            \"click #newpoint .close\": \"closeNewPoint\",\n            \"click #newpoint #mappoint\": \"startPointing\",\n            \"click #newpoint #savepoint\": \"savePoint\",\n            \"click button#editmap\": \"showEdit\",\n            \"click button#savemap\": \"updateMap\",\n            \"click button#deletemap\": \"deleteMap\"\n        },\n        \n        setMapping: function(model, data) {\n            this.id = model.id;\n            this.model = model;\n            this.points.url = '/mappings/'+this.id+'/points';\n            app.setMappingName(this.model.get('title'));\n        },\n        \n        getMappingById: function(id, callback) {\n            var view = this;\n            var mapping = new Mapping({ _id: id });\n            mapping.fetch({\n                success: function(model, data) {\n                    view.setMapping(model, data)\n                    callback(model);\n                }\n            });\n        },\n        \n        load: function(id) {       \n            this.getMappingById(id, function() {\n                this.render();\n                app.CardSlider.show('mapping');\n            }.bind(this))\n        },\n        \n        render: function() {\n            var view = this;\n            \n            this.__lastPoint = null;\n            this._newPointMarker = null;\n\n            var mapping = this.model.toJSON();\n            $('.rslide-card.mapping').remove();\n            dust.render('mapping', mapping, function(err, html) {\n                $('.rslide-card:last').after(html);                \n                view.setElement($('.rslide-card.mapping').get());\n            });\n            this.renderPoints();\n        },\n        \n        renderPoints: function() {\n            var view = this;\n\n            // Clear current state\n            this.$el.find('ul.points li').remove();\n            Map.clearPoints();\n\n            // Render Points\n            var mapping = this.model.toJSON();\n            mapping.points.forEach(function(point) {\n                view.renderPointLabel(point);\n                dust.render('point_item', point, function(err, html) {\n                    var $li = $('<li/>');\n                    $li.html(html);\n                    view.$el.find('ul.points').append($li);\n                });\n            });\n        },\n        \n        renderPointLabel: function(data) {\n            var point = new OpenLayers.LonLat(data.loc[1], data.loc[0]);\n            point.transform(\n                new OpenLayers.Projection(\"EPSG:4326\"),\n                new OpenLayers.Projection(\"EPSG:900913\")\n            );\n            Map.addMarker(point);\n        \n            // Position label\n            var popupPoint = new OpenLayers.LonLat(point.lon + 10, point.lat + 40);\n            this.popup(popupPoint, data._id, data.title);\n        },\n        \n        refresh: function(callback) {\n            var view = this;\n            this.model.fetch({\n                success: function() {\n                    view.render();\n                    callback(view.model);\n                }\n            });\n        },\n        \n        showEdit: function() {\n        },\n        \n        updateMap: function() {\n            var title = $.trim($('[name=title]').val());\n            var description = $.trim($('[name=description]').val());\n            var tags = $.trim($('[name=tags]').val());\n            \n            if(title) {\n                this.model.set('title', $('[name=title]'));\n                this.model.set('description');\n                this.model.set('tags');\n                \n                this.model.save();\n            }\n        },\n        \n        deleteMap: function() {\n            if (confirm('¿Está seguro que desea borrar este mapa?')) {\n                this.model.destroy();\n                location.href = '#mappings'\n            }\n        },\n        \n        /* Display dialog for adding a new Point\n         * to this Mapping\n         *\n         */\n        openNewPoint: function() {\n            $('#newpoint').slideDown();\n            $('button#addpoint').fadeOut('fast');\n        },\n        \n        closeNewPoint: function() {\n            $('#newpoint').slideUp(go.bind(this));\n            $('#newpoint').find('input, textarea').val('');\n            $('button#addpoint').fadeIn('fast');\n            function go() {\n                this.$el.find('#newpoint .info.pointing').find('.one, .two').show();\n                this.$el.find('#newpoint #mappoint').show();\n                this.$el.find('#newpoint .info.pointing').find('.three').hide();\n                this.$el.find('#newpoint .info.pointing').hide();\n                this.$el.find('#newpoint #savepoint').hide();  \n            }\n        },\n        \n        startPointing: function() {\n            var view = this;\n            this.$el.find('#newpoint #mappoint').fadeOut(function() {\n                view.$el.find('#newpoint .info.pointing').fadeIn();\n            });\n            Map.startPointing();\n            Map.map.events.register('click', this, this.__onClickMap);\n        },\n        \n        stopPointing: function() {\n            this.$el.find('#newpoint .info.pointing').find('.one, .two').hide();\n            this.$el.find('#newpoint .info.pointing').find('.three').show();\n            this.$el.find('#newpoint #savepoint').fadeIn();\n            Map.map.events.unregister('click', this, this.__onClickMap);\n            this._newPointMarker.events.register('click', this, this.__onClickNewPointMarker);\n        },\n\n        savePoint: function() {\n            PointForm.setElement(this.$el.find('#newpoint'));\n            var data = PointForm.getValidData();\n            if(data) {\n                data.mapping_id = this.id;\n                this.points.create(data);\n                this._newPointMarker.events.unregister('click', this, this.__onClickNewPointMarker);\n                Map.map.events.unregister('click', this, this.__onClickMap);\n                \n                // Place definite marker\n                Map.addMarker(this.__lastPoint);\n                this._newPointMarker = null;\n            }\n        },\n\n        popup: function(point, id, text) {\n            var popup = new OpenLayers.Popup('pointlabel-'+id, // Label\n                point, // Point\n                new OpenLayers.Size(text.length * 8, 15), // Size\n                text, // Text\n                true\n            );\n            \n            Map.map.addPopup(popup);\n            \n             // Style label\n            var $nodeLabel = $(\"#pointlabel-\" + id);\n            $nodeLabel.addClass(\"pointlabel\");\n            $nodeLabel.css({\n                border: \"2px solid #666\"\n            });\n            $nodeLabel.find('#pointlabel-' + id + '_close').remove();\n\n            // on mouse over label\n            $nodeLabel.on('mouseover', function(e) {\n            $nodeLabel.addClass('hover');\n            $nodeLabel.css({\n                border: \"2px solid blue\"\n                });\n            });\n\n            // on mouse out label\n            $nodeLabel.on('mouseout', function(e) {\n               $nodeLabel.removeClass('hover');\n                $nodeLabel.css({\n                    border: \"2px solid #666\"\n                });\n            });\n        },\n\n        __onClickNewPointMarker: function(e) {\n            this._newPointMarker.events.unregister('click', this, this.__onClickNewPointMarker);\n            Map.map.events.unregister('click', this, this.__onClickMap);\n            this.startPointing();\n        },\n        \n        __onClickMap: function(e) {\n            // Get Point from Event\n            var point = Map.map.getLonLatFromViewPortPx(e.xy);\n            this.__lastPoint = point.clone();\n            \n            this._newPointMarker = Map.getMarker(point);\n\n            point.transform(\n                new OpenLayers.Projection(\"EPSG:900913\"),\n                new OpenLayers.Projection(\"EPSG:4326\")\n            );\n            this.$el.find('#newpoint input[name=lat]').val(point.lat);\n            this.$el.find('#newpoint input[name=lon]').val(point.lon);\n\n            this.stopPointing();\n        }\n    }));\n    \n    var MediaGallery = new (Backbone.View.extend({\n        initialize: function() {\n            var view = this;\n            dust.render('media_gallery', {}, function(err, html) {\n                $('.root-wrapper').append(html)\n                go();\n            });\n            \n            function go() {\n                Galleria.loadTheme('/javascripts/thirdparty/galleria/themes/classic/galleria.classic.min.js');\n                Galleria.ready(function() {\n                    $('#galleria-wrapper').overlay({\n                        fixed: false,\n                        top: 32\n                    });\n                    view.galleria = Galleria.get(0);\n                });\n                // Galleria.run('#galleria', { dataSource: [{image:'/images/ajax_loader_big.gif'}] });\n            }\n        },\n        \n        load: function(data) {\n            $('#galleria-wrapper').fadeIn(function() {\n                this.galleria.load(data);\n            }.bind(this))\n        }\n    }));\n    \n    var PointView = new (Backbone.View.extend({\n        events: {\n            'click #addphoto': 'addPhoto'\n        },\n\n        initialize: function() {\n        },\n        \n        getPointById: function(mapping_id, point_id, callback) {\n            var view = this;\n            \n            this.mapping_id = mapping_id;\n            this.point_id = point_id;\n            \n            MappingView.getMappingById(mapping_id, function(mapping) {\n                view.point = _.find(mapping.get('points'), function(p) {\n                    return p._id == point_id\n                });\n                MappingView.renderPoints();\n                view.render(callback);\n            });\n        },\n        \n        render: function(callback) {\n            var view = this;\n\n            dust.render('point', this.point, function(err, html) {\n                // Remove existing data\n                $('.rslide-card.point').remove();\n                \n                $('.rslide-card:last').after(html);\n                view.setElement($('.rslide-card.point').get());\n                \n                // Setup photo upload\n                view.photoUpload();\n                \n                // Hide file input\n                var wrapper = $('<div/>').css({height:0,width:0,'overflow':'hidden'});\n                var fileInput = $(':file').wrap(wrapper);\n                fileInput.change(function(){\n                    var $this = $(this);\n                    $('#file').text($this.val());\n                });\n                // Tell the world you've finished rendering\n                if(typeof callback == 'function') callback();\n            });\n            \n            if (this.point.image.length === 0) {\n                this.$el.find('.media-image a.show').remove();\n            }\n            \n            this.mediaGallery();\n        },\n        \n        addPhoto: function() {\n            $('.media-image :file').click();\n        },\n        \n        photoUpload: function() {\n            var view = this;\n            \n            this.$el.find('.image-upload .control a').click(function(e) {\n                e.preventDefault();\n                $(this).blur();\n                \n                if ($(this).hasClass('cancel')) {\n                    view.cancelUpload();\n                }\n                if ($(this).hasClass('skip')) {\n                    view.skipCurrentUpload();\n                }\n            });\n            \n            $(\"#upload\").html5_upload({\n                url: '/mappings/'+this.mapping_id+'/points/'+this.point_id+'/image',\n                sendBoundary: window.FormData || $.browser.mozilla,\n                onStart: function(event, total) {\n                    // view.__progress = 0;\n                    //$('.meter > span').width(0);\n                    //$('.meter > span').removeClass('stop')\n                    \n                    var check = confirm(\"Está subiendo un total de \" + total + \" imágenes. ¿Desea continuar?\");\n                    if (check) {\n                        $('.image-upload').find('.control p span.index').text(' 1');\n                        $('.image-upload').find('.control p span.total').text(total);\n                        $('#addphoto').fadeOut(function() {\n                            $('.image-upload').slideDown();\n                        });\n                    }\n                    return check;\n                },\n                onStartOne: function(event, name, number, total) {\n                    view.__progress = 0;\n                    view.__uploading = true;\n                    $('.meter > span').removeClass('stop');\n                    $('.image-upload').find('.control p span.index').text(' ' + (number + 1));\n                    view.startProgressBar();\n                    return true;\n                },\n                onProgress: function(event, progress, name, number, total) {\n                    view.__progress = parseFloat((progress*100).toString().slice(0,5));\n                },\n                onFinish: function(event, response, name, number, total) {\n                    $('#addphoto').fadeIn();\n                    $('.image-upload').slideUp(function() {\n                        view.refresh()\n                    });\n                    view.__uploading = false;\n                },\n                onError: function(event, name, error) {\n                    alert('error while uploading file ' + name);\n                }\n            })\n        },\n        \n        refresh: function() {\n            var view = this;\n            MappingView.refresh(function(mapping) {\n                view.point = _.find(mapping.get('points'), function(p) {\n                    return p._id == view.point_id\n                });\n\n                view.render();\n                view.show();\n            });\n        },\n        \n        show: function() {\n            this.$el.addClass('active');\n        },\n        \n        cancelUpload: function() {\n            var view = this;\n\n            $('.media-image #upload:first').triggerHandler('html5_upload.cancelAll');\n            $('.image-upload')\n                .find('.meter > span').addClass('stop')\n                  .end()\n                .find('.control').hide()\n                  .end()\n                .find('.cancel-info').show()\n                \n            setTimeout(function() {\n                view.closeImageUpload();\n            }, 1500);\n        },\n        \n        showImageUpload: function() {\n            $('.image-upload').slideDown();\n            $('#addphoto').fadeOut();\n        },\n        \n        closeImageUpload: function() {\n            $('.image-upload').slideUp(function() {\n                $(this)\n                    .find('.meter > span').removeClass('stop')\n                        .end()\n                    .find('.control').show()\n                        .end()\n                    .find('.cancel-info').hide()\n                    \n                $('#addphoto').fadeIn();\n            });\n        },\n        \n        skipCurrentUpload: function() {\n            var view = this;\n            $('.image-upload')\n                .find('.meter > span').addClass('stop')\n            this.__uploading = false;\n            setTimeout(function() {\n                var current = $.trim($('.image-upload .control .index').text());\n                var total = $.trim($('.image-upload .control .total').text());\n                if (current === total)\n                    view.cancelUpload()\n                else\n                    $('.media-image #upload:first').triggerHandler('html5_upload.cancelOne')\n            }, 101);\n        },\n        \n        startProgressBar: function() {\n            $('.meter > span').width(0);\n            $('.meter > span').removeClass('stop')\n\n            var view = this;\n            function go() {\n                var w = view.__progress + '%';\n                if (/*view.__progress == 100 || */!view.__uploading) { return }\n                $(\".meter > span\").animate({\n                    width: w\n                }, 100, go);\n            }\n            go()\n        },\n        \n        mediaGallery: function() {\n            // $('#galleria').empty();\n            // MediaGallery.load([{ image: '/images/ajax_loader_big.gif' }]);\n            var GalleriaData = this.point.image.map(function(img) {\n                return {\n                    thumb: 'https://s3.amazonaws.com/ow-mapping/200-'+img,\n                    image: 'https://s3.amazonaws.com/ow-mapping/'+img\n                }\n            });\n\n            // Links for launching Media Gallery\n            this.$el.find('#media a.show').click(function(e) {\n                e.preventDefault();\n                $(this).blur()\n                \n                if ($(this).closest('li').hasClass('media-image')) {\n                    $('#galleria-wrapper').css({'z-index':1});\n                    MediaGallery.load(GalleriaData);\n                    if(!$('#galleria-wrapper').overlay().isOpened()) {\n                        $('#galleria-wrapper').overlay().load();\n                    }\n                }\n                \n            });\n        }\n    }));\n    \n    // Backbone Router for Mappings\n    var MappingRouter = Backbone.Router.extend({\n        routes: {\n            \"mapping/:id\": \"getMappingById\",\n            \"mappings/:mapping_id/points/:point_id\": \"getPointById\",\n            \"mappings\": \"getMyMappings\"\n        },\n        getMappingById: function(id) {\n            MappingView.load(id);\n        },\n        getMyMappings: function() {\n            app.CardSlider.show('mis-mapas');\n        },\n        getPointById: function(mapping_id, point_id) {\n            PointView.getPointById(mapping_id, point_id, function() {\n                app.CardSlider.show('point');\n            })\n        }\n    });\n    new MappingRouter();\n\n    \n    // Detect Geolocation\n    function success(pos) {\n        var position = [pos.coords.latitude, pos.coords.longitude];\n        var point = new OpenLayers.LonLat(position[1], position[0]).transform(new OpenLayers.Projection(\"EPSG:4326\"), Map.map.getProjectionObject());\n        Map.map.setCenter(point, 16);\n    }\n\n    function error() {}\n\n    if (navigator.geolocation) {\n        navigator.geolocation.getCurrentPosition(success, error);\n    } else {\n        alert('Geolocation not supported');\n        return;\n    }"],[0,"\n}\n}"]],"start1":1203,"start2":1203,"length1":21449,"length2":8}]],"length":1213,"saved":false}
{"ts":1352792593211,"patch":[[{"diffs":[[0,"   });\n    \n"],[1,"/*"],[0,"    var Publ"]],"start1":1116,"start2":1116,"length1":24,"length2":26},{"diffs":[[0,"\n    });"],[1,"*/"],[0,"\n\n\n\n}\n})"]],"start1":1198,"start2":1198,"length1":16,"length2":18}]],"length":1217,"saved":false}
{"ts":1352792648312,"patch":[[{"diffs":[[0,");\n    \n"],[-1,"/*"],[0,"    var "]],"start1":1120,"start2":1120,"length1":18,"length2":16},{"diffs":[[0,"\n    });"],[-1,"*/"],[0,"\n\n\n\n}\n})"]],"start1":1196,"start2":1196,"length1":18,"length2":16}]],"length":1213,"saved":false}
{"ts":1352792701060,"patch":[[{"diffs":[[0,") {\n    var "],[1,"_"],[0,"Shop = app.S"]],"start1":88,"start2":88,"length1":24,"length2":25}]],"length":1214,"saved":false}
{"ts":1352792815002,"patch":[[{"diffs":[[0,") {\n"],[-1,"    var _Shop = app.Shop;\n    \n"],[0,"    "]],"start1":88,"start2":88,"length1":39,"length2":8}]],"length":1183,"saved":false}
{"contributors":[],"silentsave":false,"ts":1352792973376,"patch":[[{"diffs":[[0,"            "],[1,"/*"],[0,"var data = P"]],"start1":940,"start2":940,"length1":24,"length2":26},{"diffs":[[0,"           }"],[1,"*/"],[0,"\n        }\n "]],"start1":1064,"start2":1064,"length1":24,"length2":26}]],"length":1187,"saved":false}
{"ts":1352792979819,"patch":[[{"diffs":[[0,"h: function() {\n"],[1,"            console.log('epa!!')\n"],[0,"            /*va"]],"start1":924,"start2":924,"length1":32,"length2":65}]],"length":1220,"saved":false}
{"ts":1352793005491,"patch":[[{"diffs":[[0,");\n    \n    "],[1,"/*"],[0,"var Publish "]],"start1":1127,"start2":1127,"length1":24,"length2":26},{"diffs":[[0,"\n    });"],[1,"*/"],[0,"\n\n\n\n}\n})"]],"start1":1205,"start2":1205,"length1":16,"length2":18}]],"length":1224,"saved":false}
{"ts":1352793104132,"patch":[[{"diffs":[[0,"tion(app) {\n"],[1,"    console.log('la chimba!')\n"],[0,"    /*  @Mod"]],"start1":80,"start2":80,"length1":24,"length2":54}]],"length":1254,"saved":false}
{"ts":1352793112965,"patch":[[{"diffs":[[0,") {\n"],[-1,"    console.log('la chimba!')\n"],[0,"    "]],"start1":88,"start2":88,"length1":38,"length2":8}]],"length":1224,"saved":false}
{"ts":1352793115407,"patch":[[{"diffs":[[0," @Model "],[-1,"Offering"],[1,"Shop"],[0,"\n     *\n"]],"start1":99,"start2":99,"length1":24,"length2":20}]],"length":1220,"saved":false}
{"ts":1352793135542,"patch":[[{"diffs":[[0,"publish\""],[-1,","],[0,"\n       "]],"start1":831,"start2":831,"length1":17,"length2":16}]],"length":1219,"saved":false}
{"ts":1352793159856,"patch":[[{"diffs":[[0,");\n    \n    "],[-1,"/*"],[0,"var Publish "]],"start1":1122,"start2":1122,"length1":26,"length2":24},{"diffs":[[0,"\n    });"],[-1,"*/"],[0,"\n\n\n\n}\n})"]],"start1":1198,"start2":1198,"length1":18,"length2":16}]],"length":1215,"saved":false}
{"ts":1352793217201,"patch":[[{"diffs":[[0,"e: function() {\n"],[1,"            console.log('init')\n"],[0,"        },\n     "]],"start1":869,"start2":869,"length1":32,"length2":64}]],"length":1247,"saved":false}
{"ts":1352793263493,"patch":[[{"diffs":[[0,"sh').get();\n"],[1,"    console.log(el)\n"],[0,"    var Publ"]],"start1":699,"start2":699,"length1":24,"length2":44}]],"length":1267,"saved":false}
{"ts":1352793282449,"patch":[[{"diffs":[[0,"();\n"],[-1,"    console.log(el)\n"],[0,"    "]],"start1":707,"start2":707,"length1":28,"length2":8}]],"length":1247,"saved":false}
{"ts":1352793615191,"patch":[[{"diffs":[[-1,"/*\n *  @module Shop\n *  @exports function\n *\n */\ndefine(function() {\nreturn function(app) {\n    /*  @Model Shop\n     *\n     */\n    var Shop = Backbone.Model.extend({\n        idAttribute: '_id',\n        urlRoot: '/shops'\n    });\n\n    /*  @Model Comment\n     *\n     */\n    var Comment = Backbone.Model.extend({\n        idAttribute: '_id'\n    });\n\n    /*  @Collection OfferingList\n     *\n     */\n    var ShopList = Backbone.Collection.extend({\n        model: Shop,\n        url: '/shops'\n    });\n    \n\n    /*  @Collection CommentList\n     *\n     */\n    var CommentList = Backbone.Collection.extend({\n        model: Comment\n    });\n\n\n    /*  @View PublishView\n     *\n     */\n    var el = $('section#publish').get();\n    var PublishView = new Backbone.View.extend({\n        el: el,\n\n        events: {\n            \"click a#publish-btn\": \"publish\"\n        },\n\n        initialize: function() {\n            console.log('init')\n        },\n        \n        publish: function() {\n            console.log('epa!!')\n            /*var data = PublishForm.getValidData();\n            if (data) {\n                this.collection.create(data);\n            }*/\n        }\n    });\n    \n    var Publish = new PublishView({\n        collection: new ShopList\n    });\n\n\n\n}\n});"]],"start1":0,"start2":0,"length1":1247,"length2":0}]],"length":0,"saved":false}
{"ts":1352793682190,"patch":[[{"diffs":[[1,"/*\n *  @module Mapping\n *  @exports function\n *\n */\ndefine(function() {\nreturn function(app) {\n    var Map = app.Map;\n    \n    /*  @Model Mapping\n     *\n     */\n    var Mapping = Backbone.Model.extend({\n        idAttribute: '_id',\n        urlRoot: '/mappings'\n    });\n\n    /*  @Model Point\n     *\n     */\n    var Point = Backbone.Model.extend({\n        idAttribute: '_id'\n    });\n\n    /*  @Collection MappingList\n     *\n     */\n    var MappingList = Backbone.Collection.extend({\n        model: Mapping,\n        url: '/mappings'\n    });\n    \n\n    /*  @Collection PointList\n     *\n     */\n    var PointList = Backbone.Collection.extend({\n        model: Point\n    });\n\n\n    /*  @View MyMappingsView\n     *\n     */\n    var el = $('#mis-mapas').get();\n    var MyMappingsView = Backbone.View.extend({\n        el: el,\n\n        events: {\n            \"click button#addmap\": \"openNewMap\",\n            \"keypress input\": \"captureKey\",\n            \"click #newmap .close\": \"closeNewMap\",\n            \"click button#savemap\": \"createMapping\"\n        },\n\n        initialize: function() {\n            var view = this;\n            this.render();\n            $(window).on('keydown', function(e) {\n                if (e.keyCode == 27) {\n                    view.closeNewMap();\n                }\n            });\n\n            this.collection.on('sync', function(e, f) {\n                view.render();\n                view.closeNewMap();\n                location.hash = \"#mapping/\"+e.id;\n            });\n        },\n\n        render: function() {\n            this.collection.fetch({\n                data: {\n                    user_id: this.user_id\n                },\n                success: function(coll, data) {\n                    $('ul.mappings').empty();\n                    data.forEach(function(item) {\n                        item.id = item._id;\n                        dust.render('mapping_item', item, function(err, html) {\n                            $('ul.mappings').append(html);\n                        });\n                    });\n                }\n            });\n        },\n\n        openNewMap: function() {\n            $('#newmap').slideDown('fast', function() {\n                // $('#newmap .close').show()\n            });\n            $('.overlay').fadeIn('fast');\n            $('#newmap input').focus();\n            $('button#addmap').fadeOut('fast');\n        },\n\n        closeNewMap: function() {\n            $('#newmap').slideUp('fast', function() {\n                // $('#newmap .close').hide()\n            });\n            $('.overlay').fadeOut('fast');\n            $('button#addmap').fadeIn('fast');\n        },\n\n        createMapping: function() {\n            var title = $.trim($('#newmap input').val());\n            if (!title) {\n                return false\n            }\n            this.collection.create({\n                title: title\n            });\n        },\n\n        captureKey: function(e) {\n            switch (e.keyCode) {\n            case 13:\n                this.createMapping();\n                break;\n            default:\n                break;\n            }\n        }\n    });\n\n    var View = new MyMappingsView({\n        collection: new MappingList\n    });\n\n    /*  @View MappingView\n     *\n     */\n    var MappingView = new (Backbone.View.extend({        \n        initialize: function() {\n            var view = this;\n            \n            this.points = new PointList;\n            this.points.on('sync', function(e) {\n                this.closeNewPoint();\n                this.refresh(onRefresh);\n                function onRefresh() {\n                    $('.rslide-card.mapping').addClass('active')\n                }\n            }.bind(this));\n        },\n\n        events: {\n            \"click button#addpoint\": \"openNewPoint\",\n            \"click #newpoint .close\": \"closeNewPoint\",\n            \"click #newpoint #mappoint\": \"startPointing\",\n            \"click #newpoint #savepoint\": \"savePoint\",\n            \"click button#editmap\": \"showEdit\",\n            \"click button#savemap\": \"updateMap\",\n            \"click button#deletemap\": \"deleteMap\"\n        },\n        \n        setMapping: function(model, data) {\n            this.id = model.id;\n            this.model = model;\n            this.points.url = '/mappings/'+this.id+'/points';\n            app.setMappingName(this.model.get('title'));\n        },\n        \n        getMappingById: function(id, callback) {\n            var view = this;\n            var mapping = new Mapping({ _id: id });\n            mapping.fetch({\n                success: function(model, data) {\n                    view.setMapping(model, data)\n                    callback(model);\n                }\n            });\n        },\n        \n        load: function(id) {       \n            this.getMappingById(id, function() {\n                this.render();\n                app.CardSlider.show('mapping');\n            }.bind(this))\n        },\n        \n        render: function() {\n            var view = this;\n            \n            this.__lastPoint = null;\n            this._newPointMarker = null;\n\n            var mapping = this.model.toJSON();\n            $('.rslide-card.mapping').remove();\n            dust.render('mapping', mapping, function(err, html) {\n                $('.rslide-card:last').after(html);                \n                view.setElement($('.rslide-card.mapping').get());\n            });\n            this.renderPoints();\n        },\n        \n        renderPoints: function() {\n            var view = this;\n\n            // Clear current state\n            this.$el.find('ul.points li').remove();\n            Map.clearPoints();\n\n            // Render Points\n            var mapping = this.model.toJSON();\n            mapping.points.forEach(function(point) {\n                view.renderPointLabel(point);\n                dust.render('point_item', point, function(err, html) {\n                    var $li = $('<li/>');\n                    $li.html(html);\n                    view.$el.find('ul.points').append($li);\n                });\n            });\n        },\n        \n        renderPointLabel: function(data) {\n            var point = new OpenLayers.LonLat(data.loc[1], data.loc[0]);\n            point.transform(\n                new OpenLayers.Projection(\"EPSG:4326\"),\n                new OpenLayers.Projection(\"EPSG:900913\")\n            );\n            Map.addMarker(point);\n        \n            // Position label\n            var popupPoint = new OpenLayers.LonLat(point.lon + 10, point.lat + 40);\n            this.popup(popupPoint, data._id, data.title);\n        },\n        \n        refresh: function(callback) {\n            var view = this;\n            this.model.fetch({\n                success: function() {\n                    view.render();\n                    callback(view.model);\n                }\n            });\n        },\n        \n        showEdit: function() {\n        },\n        \n        updateMap: function() {\n            var title = $.trim($('[name=title]').val());\n            var description = $.trim($('[name=description]').val());\n            var tags = $.trim($('[name=tags]').val());\n            \n            if(title) {\n                this.model.set('title', $('[name=title]'));\n                this.model.set('description');\n                this.model.set('tags');\n                \n                this.model.save();\n            }\n        },\n        \n        deleteMap: function() {\n            if (confirm('¿Está seguro que desea borrar este mapa?')) {\n                this.model.destroy();\n                location.href = '#mappings'\n            }\n        },\n        \n        /* Display dialog for adding a new Point\n         * to this Mapping\n         *\n         */\n        openNewPoint: function() {\n            $('#newpoint').slideDown();\n            $('button#addpoint').fadeOut('fast');\n        },\n        \n        closeNewPoint: function() {\n            $('#newpoint').slideUp(go.bind(this));\n            $('#newpoint').find('input, textarea').val('');\n            $('button#addpoint').fadeIn('fast');\n            function go() {\n                this.$el.find('#newpoint .info.pointing').find('.one, .two').show();\n                this.$el.find('#newpoint #mappoint').show();\n                this.$el.find('#newpoint .info.pointing').find('.three').hide();\n                this.$el.find('#newpoint .info.pointing').hide();\n                this.$el.find('#newpoint #savepoint').hide();  \n            }\n        },\n        \n        startPointing: function() {\n            var view = this;\n            this.$el.find('#newpoint #mappoint').fadeOut(function() {\n                view.$el.find('#newpoint .info.pointing').fadeIn();\n            });\n            Map.startPointing();\n            Map.map.events.register('click', this, this.__onClickMap);\n        },\n        \n        stopPointing: function() {\n            this.$el.find('#newpoint .info.pointing').find('.one, .two').hide();\n            this.$el.find('#newpoint .info.pointing').find('.three').show();\n            this.$el.find('#newpoint #savepoint').fadeIn();\n            Map.map.events.unregister('click', this, this.__onClickMap);\n            this._newPointMarker.events.register('click', this, this.__onClickNewPointMarker);\n        },\n\n        savePoint: function() {\n            PointForm.setElement(this.$el.find('#newpoint'));\n            var data = PointForm.getValidData();\n            if(data) {\n                data.mapping_id = this.id;\n                this.points.create(data);\n                this._newPointMarker.events.unregister('click', this, this.__onClickNewPointMarker);\n                Map.map.events.unregister('click', this, this.__onClickMap);\n                \n                // Place definite marker\n                Map.addMarker(this.__lastPoint);\n                this._newPointMarker = null;\n            }\n        },\n\n        popup: function(point, id, text) {\n            var popup = new OpenLayers.Popup('pointlabel-'+id, // Label\n                point, // Point\n                new OpenLayers.Size(text.length * 8, 15), // Size\n                text, // Text\n                true\n            );\n            \n            Map.map.addPopup(popup);\n            \n             // Style label\n            var $nodeLabel = $(\"#pointlabel-\" + id);\n            $nodeLabel.addClass(\"pointlabel\");\n            $nodeLabel.css({\n                border: \"2px solid #666\"\n            });\n            $nodeLabel.find('#pointlabel-' + id + '_close').remove();\n\n            // on mouse over label\n            $nodeLabel.on('mouseover', function(e) {\n            $nodeLabel.addClass('hover');\n            $nodeLabel.css({\n                border: \"2px solid blue\"\n                });\n            });\n\n            // on mouse out label\n            $nodeLabel.on('mouseout', function(e) {\n               $nodeLabel.removeClass('hover');\n                $nodeLabel.css({\n                    border: \"2px solid #666\"\n                });\n            });\n        },\n\n        __onClickNewPointMarker: function(e) {\n            this._newPointMarker.events.unregister('click', this, this.__onClickNewPointMarker);\n            Map.map.events.unregister('click', this, this.__onClickMap);\n            this.startPointing();\n        },\n        \n        __onClickMap: function(e) {\n            // Get Point from Event\n            var point = Map.map.getLonLatFromViewPortPx(e.xy);\n            this.__lastPoint = point.clone();\n            \n            this._newPointMarker = Map.getMarker(point);\n\n            point.transform(\n                new OpenLayers.Projection(\"EPSG:900913\"),\n                new OpenLayers.Projection(\"EPSG:4326\")\n            );\n            this.$el.find('#newpoint input[name=lat]').val(point.lat);\n            this.$el.find('#newpoint input[name=lon]').val(point.lon);\n\n            this.stopPointing();\n        }\n    }));\n    \n    var MediaGallery = new (Backbone.View.extend({\n        initialize: function() {\n            var view = this;\n            dust.render('media_gallery', {}, function(err, html) {\n                $('.root-wrapper').append(html)\n                go();\n            });\n            \n            function go() {\n                Galleria.loadTheme('/javascripts/thirdparty/galleria/themes/classic/galleria.classic.min.js');\n                Galleria.ready(function() {\n                    $('#galleria-wrapper').overlay({\n                        fixed: false,\n                        top: 32\n                    });\n                    view.galleria = Galleria.get(0);\n                });\n                Galleria.run('#galleria', { dataSource: [{image:'/images/marker.png'}] });\n            }\n        },\n        \n        load: function(data) {\n            $('#galleria-wrapper').fadeIn(function() {\n                this.galleria.load(data);\n            }.bind(this))\n        }\n    }));\n    \n    var PointView = new (Backbone.View.extend({\n        events: {\n            'click #addphoto': 'addPhoto'\n        },\n\n        initialize: function() {\n        },\n        \n        getPointById: function(mapping_id, point_id, callback) {\n            var view = this;\n            \n            this.mapping_id = mapping_id;\n            this.point_id = point_id;\n            \n            MappingView.getMappingById(mapping_id, function(mapping) {\n                view.point = _.find(mapping.get('points'), function(p) {\n                    return p._id == point_id\n                });\n                MappingView.renderPoints();\n                view.render(callback);\n            });\n        },\n        \n        render: function(callback) {\n            var view = this;\n\n            dust.render('point', this.point, function(err, html) {\n                // Remove existing data\n                $('.rslide-card.point').remove();\n                \n                $('.rslide-card:last').after(html);\n                view.setElement($('.rslide-card.point').get());\n                \n                // Setup photo upload\n                view.photoUpload();\n                \n                // Hide file input\n                var wrapper = $('<div/>').css({height:0,width:0,'overflow':'hidden'});\n                var fileInput = $(':file').wrap(wrapper);\n                fileInput.change(function(){\n                    var $this = $(this);\n                    $('#file').text($this.val());\n                });\n                // Tell the world you've finished rendering\n                if(typeof callback == 'function') callback();\n            });\n            \n            if (this.point.image.length === 0) {\n                this.$el.find('.media-image a.show').remove();\n            }\n            \n            this.mediaGallery();\n        },\n        \n        addPhoto: function() {\n            $('.media-image :file').click();\n        },\n        \n        photoUpload: function() {\n            var view = this;\n            \n            this.$el.find('.image-upload .control a').click(function(e) {\n                e.preventDefault();\n                $(this).blur();\n                \n                if ($(this).hasClass('cancel')) {\n                    view.cancelUpload();\n                }\n                if ($(this).hasClass('skip')) {\n                    view.skipCurrentUpload();\n                }\n            });\n            \n            $(\"#upload\").html5_upload({\n                url: '/mappings/'+this.mapping_id+'/points/'+this.point_id+'/image',\n                sendBoundary: window.FormData || $.browser.mozilla,\n                onStart: function(event, total) {\n                    // view.__progress = 0;\n                    //$('.meter > span').width(0);\n                    //$('.meter > span').removeClass('stop')\n                    \n                    var check = confirm(\"Está subiendo un total de \" + total + \" imágenes. ¿Desea continuar?\");\n                    if (check) {\n                        $('.image-upload').find('.control p span.index').text(' 1');\n                        $('.image-upload').find('.control p span.total').text(total);\n                        $('#addphoto').fadeOut(function() {\n                            $('.image-upload').slideDown();\n                        });\n                    }\n                    return check;\n                },\n                onStartOne: function(event, name, number, total) {\n                    view.__progress = 0;\n                    view.__uploading = true;\n                    $('.meter > span').removeClass('stop');\n                    $('.image-upload').find('.control p span.index').text(' ' + (number + 1));\n                    view.startProgressBar();\n                    return true;\n                },\n                onProgress: function(event, progress, name, number, total) {\n                    view.__progress = parseFloat((progress*100).toString().slice(0,5));\n                },\n                onFinish: function(event, response, name, number, total) {\n                    $('#addphoto').fadeIn();\n                    $('.image-upload').slideUp(function() {\n                        view.refresh()\n                    });\n                    view.__uploading = false;\n                },\n                onError: function(event, name, error) {\n                    alert('error while uploading file ' + name);\n                }\n            })\n        },\n        \n        refresh: function() {\n            var view = this;\n            MappingView.refresh(function(mapping) {\n                view.point = _.find(mapping.get('points'), function(p) {\n                    return p._id == view.point_id\n                });\n\n                view.render();\n                view.show();\n            });\n        },\n        \n        show: function() {\n            this.$el.addClass('active');\n        },\n        \n        cancelUpload: function() {\n            var view = this;\n\n            $('.media-image #upload:first').triggerHandler('html5_upload.cancelAll');\n            $('.image-upload')\n                .find('.meter > span').addClass('stop')\n                  .end()\n                .find('.control').hide()\n                  .end()\n                .find('.cancel-info').show()\n                \n            setTimeout(function() {\n                view.closeImageUpload();\n            }, 1500);\n        },\n        \n        showImageUpload: function() {\n            $('.image-upload').slideDown();\n            $('#addphoto').fadeOut();\n        },\n        \n        closeImageUpload: function() {\n            $('.image-upload').slideUp(function() {\n                $(this)\n                    .find('.meter > span').removeClass('stop')\n                        .end()\n                    .find('.control').show()\n                        .end()\n                    .find('.cancel-info').hide()\n                    \n                $('#addphoto').fadeIn();\n            });\n        },\n        \n        skipCurrentUpload: function() {\n            var view = this;\n            $('.image-upload')\n                .find('.meter > span').addClass('stop')\n            this.__uploading = false;\n            setTimeout(function() {\n                var current = $.trim($('.image-upload .control .index').text());\n                var total = $.trim($('.image-upload .control .total').text());\n                if (current === total)\n                    view.cancelUpload()\n                else\n                    $('.media-image #upload:first').triggerHandler('html5_upload.cancelOne')\n            }, 101);\n        },\n        \n        startProgressBar: function() {\n            $('.meter > span').width(0);\n            $('.meter > span').removeClass('stop')\n\n            var view = this;\n            function go() {\n                var w = view.__progress + '%';\n                if (/*view.__progress == 100 || */!view.__uploading) { return }\n                $(\".meter > span\").animate({\n                    width: w\n                }, 100, go);\n            }\n            go()\n        },\n        \n        mediaGallery: function() {\n            var GalleriaData = this.point.image.map(function(img) {\n                return {\n                    thumb: 'https://s3.amazonaws.com/ow-mapping/200-'+img,\n                    image: 'https://s3.amazonaws.com/ow-mapping/'+img\n                }\n            });\n            \n            // Links for launching media gallery\n            this.$el.find('#media a.show').click(function(e) {\n                e.preventDefault();\n                $(this).blur()\n                \n                if ($(this).closest('li').hasClass('media-image')) {\n                    $('#galleria-wrapper').css({'z-index':1});\n                    MediaGallery.load(GalleriaData);\n                    if(!$('#galleria-wrapper').overlay().isOpened()) {\n                        $('#galleria-wrapper').overlay().load();\n                    }\n                }\n                \n            });\n        }\n    }));\n    \n    // Backbone Router for Mappings\n    var MappingRouter = Backbone.Router.extend({\n        routes: {\n            \"mapping/:id\": \"getMappingById\",\n            \"mappings/:mapping_id/points/:point_id\": \"getPointById\",\n            \"mappings\": \"getMyMappings\"\n        },\n        getMappingById: function(id) {\n            MappingView.load(id);\n        },\n        getMyMappings: function() {\n            app.CardSlider.show('mis-mapas');\n        },\n        getPointById: function(mapping_id, point_id) {\n            PointView.getPointById(mapping_id, point_id, function() {\n                app.CardSlider.show('point');\n            })\n        }\n    });\n    new MappingRouter();\n\n    \n    // Detect Geolocation\n    function success(pos) {\n        var position = [pos.coords.latitude, pos.coords.longitude];\n        var point = new OpenLayers.LonLat(position[1], position[0]).transform(new OpenLayers.Projection(\"EPSG:4326\"), Map.map.getProjectionObject());\n        Map.map.setCenter(point, 16);\n    }\n\n    function error() {}\n\n    if (navigator.geolocation) {\n        navigator.geolocation.getCurrentPosition(success, error);\n    } else {\n        alert('Geolocation not supported');\n        return;\n    }\n}\n});"]],"start1":0,"start2":0,"length1":0,"length2":21997}]],"length":21997,"saved":false}
{"ts":1352793850565,"patch":[[{"diffs":[[0,"    "],[-1,"\n    // Detect Geolocation\n    function success(pos) {\n        var position = [pos.coords.latitude, pos.coords.longitude];\n        var point = new OpenLayers.LonLat(position[1], position[0]).transform(new OpenLayers.Projection(\"EPSG:4326\"), Map.map.getProjectionObject());\n        Map.map.setCenter(point, 16);\n    }\n\n    function error() {}\n\n    if (navigator.geolocation) {\n        navigator.geolocation.getCurrentPosition(success, error);\n    } else {\n        alert('Geolocation not supported');\n        return;\n    }\n"],[0,"}\n})"]],"start1":21467,"start2":21467,"length1":529,"length2":8}]],"length":21476,"saved":false}
{"ts":1352793883563,"patch":[[{"diffs":[[0,") {\n"],[-1,"            MappingView.load(id);\n"],[0,"    "]],"start1":21095,"start2":21095,"length1":42,"length2":8},{"diffs":[[0,") {\n"],[-1,"            app.CardSlider.show('mis-mapas');\n"],[0,"    "]],"start1":21142,"start2":21142,"length1":54,"length2":8},{"diffs":[[0,") {\n"],[-1,"            PointView.getPointById(mapping_id, point_id, function() {\n                app.CardSlider.show('point');\n            })\n"],[0,"    "]],"start1":21208,"start2":21208,"length1":139,"length2":8}]],"length":21265,"saved":false}
{"ts":1352793906177,"patch":[[{"diffs":[[0,"    "],[-1,"\n    // Backbone Router for Mappings\n    var MappingRouter = Backbone.Router.extend({\n        routes: {\n            \"mapping/:id\": \"getMappingById\",\n            \"mappings/:mapping_id/points/:point_id\": \"getPointById\",\n            \"mappings\": \"getMyMappings\"\n        },\n        getMappingById: function(id) {\n        },\n        getMyMappings: function() {\n        },\n        getPointById: function(mapping_id, point_id) {\n        }\n    });\n    new MappingRouter();"],[0,"\n\n  "]],"start1":20787,"start2":20787,"length1":471,"length2":8}]],"length":20802,"saved":false}
{"ts":1352793969286,"patch":[[{"diffs":[[0,"   \n"],[-1,"    var PointView = new (Backbone.View.extend({\n        events: {\n            'click #addphoto': 'addPhoto'\n        },\n\n        initialize: function() {\n        },\n        \n        getPointById: function(mapping_id, point_id, callback) {\n            var view = this;\n            \n            this.mapping_id = mapping_id;\n            this.point_id = point_id;\n            \n            MappingView.getMappingById(mapping_id, function(mapping) {\n                view.point = _.find(mapping.get('points'), function(p) {\n                    return p._id == point_id\n                });\n                MappingView.renderPoints();\n                view.render(callback);\n            });\n        },\n        \n        render: function(callback) {\n            var view = this;\n\n            dust.render('point', this.point, function(err, html) {\n                // Remove existing data\n                $('.rslide-card.point').remove();\n                \n                $('.rslide-card:last').after(html);\n                view.setElement($('.rslide-card.point').get());\n                \n                // Setup photo upload\n                view.photoUpload();\n                \n                // Hide file input\n                var wrapper = $('<div/>').css({height:0,width:0,'overflow':'hidden'});\n                var fileInput = $(':file').wrap(wrapper);\n                fileInput.change(function(){\n                    var $this = $(this);\n                    $('#file').text($this.val());\n                });\n                // Tell the world you've finished rendering\n                if(typeof callback == 'function') callback();\n            });\n            \n            if (this.point.image.length === 0) {\n                this.$el.find('.media-image a.show').remove();\n            }\n            \n            this.mediaGallery();\n        },\n        \n        addPhoto: function() {\n            $('.media-image :file').click();\n        },\n        \n        photoUpload: function() {\n            var view = this;\n            \n            this.$el.find('.image-upload .control a').click(function(e) {\n                e.preventDefault();\n                $(this).blur();\n                \n                if ($(this).hasClass('cancel')) {\n                    view.cancelUpload();\n                }\n                if ($(this).hasClass('skip')) {\n                    view.skipCurrentUpload();\n                }\n            });\n            \n            $(\"#upload\").html5_upload({\n                url: '/mappings/'+this.mapping_id+'/points/'+this.point_id+'/image',\n                sendBoundary: window.FormData || $.browser.mozilla,\n                onStart: function(event, total) {\n                    // view.__progress = 0;\n                    //$('.meter > span').width(0);\n                    //$('.meter > span').removeClass('stop')\n                    \n                    var check = confirm(\"Está subiendo un total de \" + total + \" imágenes. ¿Desea continuar?\");\n                    if (check) {\n                        $('.image-upload').find('.control p span.index').text(' 1');\n                        $('.image-upload').find('.control p span.total').text(total);\n                        $('#addphoto').fadeOut(function() {\n                            $('.image-upload').slideDown();\n                        });\n                    }\n                    return check;\n                },\n                onStartOne: function(event, name, number, total) {\n                    view.__progress = 0;\n                    view.__uploading = true;\n                    $('.meter > span').removeClass('stop');\n                    $('.image-upload').find('.control p span.index').text(' ' + (number + 1));\n                    view.startProgressBar();\n                    return true;\n                },\n                onProgress: function(event, progress, name, number, total) {\n                    view.__progress = parseFloat((progress*100).toString().slice(0,5));\n                },\n                onFinish: function(event, response, name, number, total) {\n                    $('#addphoto').fadeIn();\n                    $('.image-upload').slideUp(function() {\n                        view.refresh()\n                    });\n                    view.__uploading = false;\n                },\n                onError: function(event, name, error) {\n                    alert('error while uploading file ' + name);\n                }\n            })\n        },\n        \n        refresh: function() {\n            var view = this;\n            MappingView.refresh(function(mapping) {\n                view.point = _.find(mapping.get('points'), function(p) {\n                    return p._id == view.point_id\n                });\n\n                view.render();\n                view.show();\n            });\n        },\n        \n        show: function() {\n            this.$el.addClass('active');\n        },\n        \n        cancelUpload: function() {\n            var view = this;\n\n            $('.media-image #upload:first').triggerHandler('html5_upload.cancelAll');\n            $('.image-upload')\n                .find('.meter > span').addClass('stop')\n                  .end()\n                .find('.control').hide()\n                  .end()\n                .find('.cancel-info').show()\n                \n            setTimeout(function() {\n                view.closeImageUpload();\n            }, 1500);\n        },\n        \n        showImageUpload: function() {\n            $('.image-upload').slideDown();\n            $('#addphoto').fadeOut();\n        },\n        \n        closeImageUpload: function() {\n            $('.image-upload').slideUp(function() {\n                $(this)\n                    .find('.meter > span').removeClass('stop')\n                        .end()\n                    .find('.control').show()\n                        .end()\n                    .find('.cancel-info').hide()\n                    \n                $('#addphoto').fadeIn();\n            });\n        },\n        \n        skipCurrentUpload: function() {\n            var view = this;\n            $('.image-upload')\n                .find('.meter > span').addClass('stop')\n            this.__uploading = false;\n            setTimeout(function() {\n                var current = $.trim($('.image-upload .control .index').text());\n                var total = $.trim($('.image-upload .control .total').text());\n                if (current === total)\n                    view.cancelUpload()\n                else\n                    $('.media-image #upload:first').triggerHandler('html5_upload.cancelOne')\n            }, 101);\n        },\n        \n        startProgressBar: function() {\n            $('.meter > span').width(0);\n            $('.meter > span').removeClass('stop')\n\n            var view = this;\n            function go() {\n                var w = view.__progress + '%';\n                if (/*view.__progress == 100 || */!view.__uploading) { return }\n                $(\".meter > span\").animate({\n                    width: w\n                }, 100, go);\n            }\n            go()\n        },\n        \n        mediaGallery: function() {\n            var GalleriaData = this.point.image.map(function(img) {\n                return {\n                    thumb: 'https://s3.amazonaws.com/ow-mapping/200-'+img,\n                    image: 'https://s3.amazonaws.com/ow-mapping/'+img\n                }\n            });\n            \n            // Links for launching media gallery\n            this.$el.find('#media a.show').click(function(e) {\n                e.preventDefault();\n                $(this).blur()\n                \n                if ($(this).closest('li').hasClass('media-image')) {\n                    $('#galleria-wrapper').css({'z-index':1});\n                    MediaGallery.load(GalleriaData);\n                    if(!$('#galleria-wrapper').overlay().isOpened()) {\n                        $('#galleria-wrapper').overlay().load();\n                    }\n                }\n                \n            });\n        }\n    }));\n    \n\n"],[0,"    "]],"start1":12783,"start2":12783,"length1":8014,"length2":8}]],"length":12796,"saved":false}
{"ts":1352793995387,"patch":[[{"diffs":[[0,"   \n"],[-1,"    var MediaGallery = new (Backbone.View.extend({\n        initialize: function() {\n            var view = this;\n            dust.render('media_gallery', {}, function(err, html) {\n                $('.root-wrapper').append(html)\n                go();\n            });\n            \n            function go() {\n                Galleria.loadTheme('/javascripts/thirdparty/galleria/themes/classic/galleria.classic.min.js');\n                Galleria.ready(function() {\n                    $('#galleria-wrapper').overlay({\n                        fixed: false,\n                        top: 32\n                    });\n                    view.galleria = Galleria.get(0);\n                });\n                Galleria.run('#galleria', { dataSource: [{image:'/images/marker.png'}] });\n            }\n        },\n        \n        load: function(data) {\n            $('#galleria-wrapper').fadeIn(function() {\n                this.galleria.load(data);\n            }.bind(this))\n        }\n    }));\n    "],[0,"\n   "]],"start1":11798,"start2":11798,"length1":992,"length2":8}]],"length":11812,"saved":false}
{"ts":1352794069593,"patch":[[{"diffs":[[0,"});\n"],[-1,"\n    /*  @View MappingView\n     *\n     */\n    var MappingView = new (Backbone.View.extend({        \n        initialize: function() {\n            var view = this;\n            \n            this.points = new PointList;\n            this.points.on('sync', function(e) {\n                this.closeNewPoint();\n                this.refresh(onRefresh);\n                function onRefresh() {\n                    $('.rslide-card.mapping').addClass('active')\n                }\n            }.bind(this));\n        },\n\n        events: {\n            \"click button#addpoint\": \"openNewPoint\",\n            \"click #newpoint .close\": \"closeNewPoint\",\n            \"click #newpoint #mappoint\": \"startPointing\",\n            \"click #newpoint #savepoint\": \"savePoint\",\n            \"click button#editmap\": \"showEdit\",\n            \"click button#savemap\": \"updateMap\",\n            \"click button#deletemap\": \"deleteMap\"\n        },\n        \n        setMapping: function(model, data) {\n            this.id = model.id;\n            this.model = model;\n            this.points.url = '/mappings/'+this.id+'/points';\n            app.setMappingName(this.model.get('title'));\n        },\n        \n        getMappingById: function(id, callback) {\n            var view = this;\n            var mapping = new Mapping({ _id: id });\n            mapping.fetch({\n                success: function(model, data) {\n                    view.setMapping(model, data)\n                    callback(model);\n                }\n            });\n        },\n        \n        load: function(id) {       \n            this.getMappingById(id, function() {\n                this.render();\n                app.CardSlider.show('mapping');\n            }.bind(this))\n        },\n        \n        render: function() {\n            var view = this;\n            \n            this.__lastPoint = null;\n            this._newPointMarker = null;\n\n            var mapping = this.model.toJSON();\n            $('.rslide-card.mapping').remove();\n            dust.render('mapping', mapping, function(err, html) {\n                $('.rslide-card:last').after(html);                \n                view.setElement($('.rslide-card.mapping').get());\n            });\n            this.renderPoints();\n        },\n        \n        renderPoints: function() {\n            var view = this;\n\n            // Clear current state\n            this.$el.find('ul.points li').remove();\n            Map.clearPoints();\n\n            // Render Points\n            var mapping = this.model.toJSON();\n            mapping.points.forEach(function(point) {\n                view.renderPointLabel(point);\n                dust.render('point_item', point, function(err, html) {\n                    var $li = $('<li/>');\n                    $li.html(html);\n                    view.$el.find('ul.points').append($li);\n                });\n            });\n        },\n        \n        renderPointLabel: function(data) {\n            var point = new OpenLayers.LonLat(data.loc[1], data.loc[0]);\n            point.transform(\n                new OpenLayers.Projection(\"EPSG:4326\"),\n                new OpenLayers.Projection(\"EPSG:900913\")\n            );\n            Map.addMarker(point);\n        \n            // Position label\n            var popupPoint = new OpenLayers.LonLat(point.lon + 10, point.lat + 40);\n            this.popup(popupPoint, data._id, data.title);\n        },\n        \n        refresh: function(callback) {\n            var view = this;\n            this.model.fetch({\n                success: function() {\n                    view.render();\n                    callback(view.model);\n                }\n            });\n        },\n        \n        showEdit: function() {\n        },\n        \n        updateMap: function() {\n            var title = $.trim($('[name=title]').val());\n            var description = $.trim($('[name=description]').val());\n            var tags = $.trim($('[name=tags]').val());\n            \n            if(title) {\n                this.model.set('title', $('[name=title]'));\n                this.model.set('description');\n                this.model.set('tags');\n                \n                this.model.save();\n            }\n        },\n        \n        deleteMap: function() {\n            if (confirm('¿Está seguro que desea borrar este mapa?')) {\n                this.model.destroy();\n                location.href = '#mappings'\n            }\n        },\n        \n        /* Display dialog for adding a new Point\n         * to this Mapping\n         *\n         */\n        openNewPoint: function() {\n            $('#newpoint').slideDown();\n            $('button#addpoint').fadeOut('fast');\n        },\n        \n        closeNewPoint: function() {\n            $('#newpoint').slideUp(go.bind(this));\n            $('#newpoint').find('input, textarea').val('');\n            $('button#addpoint').fadeIn('fast');\n            function go() {\n                this.$el.find('#newpoint .info.pointing').find('.one, .two').show();\n                this.$el.find('#newpoint #mappoint').show();\n                this.$el.find('#newpoint .info.pointing').find('.three').hide();\n                this.$el.find('#newpoint .info.pointing').hide();\n                this.$el.find('#newpoint #savepoint').hide();  \n            }\n        },\n        \n        startPointing: function() {\n            var view = this;\n            this.$el.find('#newpoint #mappoint').fadeOut(function() {\n                view.$el.find('#newpoint .info.pointing').fadeIn();\n            });\n            Map.startPointing();\n            Map.map.events.register('click', this, this.__onClickMap);\n        },\n        \n        stopPointing: function() {\n            this.$el.find('#newpoint .info.pointing').find('.one, .two').hide();\n            this.$el.find('#newpoint .info.pointing').find('.three').show();\n            this.$el.find('#newpoint #savepoint').fadeIn();\n            Map.map.events.unregister('click', this, this.__onClickMap);\n            this._newPointMarker.events.register('click', this, this.__onClickNewPointMarker);\n        },\n\n        savePoint: function() {\n            PointForm.setElement(this.$el.find('#newpoint'));\n            var data = PointForm.getValidData();\n            if(data) {\n                data.mapping_id = this.id;\n                this.points.create(data);\n                this._newPointMarker.events.unregister('click', this, this.__onClickNewPointMarker);\n                Map.map.events.unregister('click', this, this.__onClickMap);\n                \n                // Place definite marker\n                Map.addMarker(this.__lastPoint);\n                this._newPointMarker = null;\n            }\n        },\n\n        popup: function(point, id, text) {\n            var popup = new OpenLayers.Popup('pointlabel-'+id, // Label\n                point, // Point\n                new OpenLayers.Size(text.length * 8, 15), // Size\n                text, // Text\n                true\n            );\n            \n            Map.map.addPopup(popup);\n            \n             // Style label\n            var $nodeLabel = $(\"#pointlabel-\" + id);\n            $nodeLabel.addClass(\"pointlabel\");\n            $nodeLabel.css({\n                border: \"2px solid #666\"\n            });\n            $nodeLabel.find('#pointlabel-' + id + '_close').remove();\n\n            // on mouse over label\n            $nodeLabel.on('mouseover', function(e) {\n            $nodeLabel.addClass('hover');\n            $nodeLabel.css({\n                border: \"2px solid blue\"\n                });\n            });\n\n            // on mouse out label\n            $nodeLabel.on('mouseout', function(e) {\n               $nodeLabel.removeClass('hover');\n                $nodeLabel.css({\n                    border: \"2px solid #666\"\n                });\n            });\n        },\n\n        __onClickNewPointMarker: function(e) {\n            this._newPointMarker.events.unregister('click', this, this.__onClickNewPointMarker);\n            Map.map.events.unregister('click', this, this.__onClickMap);\n            this.startPointing();\n        },\n        \n        __onClickMap: function(e) {\n            // Get Point from Event\n            var point = Map.map.getLonLatFromViewPortPx(e.xy);\n            this.__lastPoint = point.clone();\n            \n            this._newPointMarker = Map.getMarker(point);\n\n            point.transform(\n                new OpenLayers.Projection(\"EPSG:900913\"),\n                new OpenLayers.Projection(\"EPSG:4326\")\n            );\n            this.$el.find('#newpoint input[name=lat]').val(point.lat);\n            this.$el.find('#newpoint input[name=lon]').val(point.lon);\n\n            this.stopPointing();\n        }\n    }));\n   "],[0," \n\n "]],"start1":3171,"start2":3171,"length1":8633,"length2":8}]],"length":3187,"saved":false}
{"ts":1352794104875,"patch":[[{"diffs":[[0,"n(app) {\n   "],[1," //"],[0," var Map = a"]],"start1":86,"start2":86,"length1":24,"length2":27}]],"length":3190,"saved":false}
{"ts":1352794133084,"patch":[[{"diffs":[[0,"    "],[-1,"    var view = this;\n            this.render();\n            $(window).on('keydown', function(e) {\n                if (e.keyCode == 27) {\n                    view.closeNewMap();\n                }\n            });\n\n            this.collection.on('sync', function(e, f) {\n                view.render();\n                view.closeNewMap();\n                location.hash = \"#mapping/\"+e.id;\n            });\n        },\n\n        render: function() {\n            this.collection.fetch({\n                data: {\n                    user_id: this.user_id\n                },\n                success: function(coll, data) {\n                    $('ul.mappings').empty();\n                    data.forEach(function(item) {\n                        item.id = item._id;\n                        dust.render('mapping_item', item, function(err, html) {\n                            $('ul.mappings').append(html);\n                        });\n                    });\n                }\n            });"],[1,"},\n\n        render: function() {"],[0,"\n   "]],"start1":1078,"start2":1078,"length1":983,"length2":40}]],"length":2247,"saved":false}
{"ts":1352794179867,"patch":[[{"diffs":[[0,"},\n\n"],[-1,"        openNewMap: function() {\n            $('#newmap').slideDown('fast', function() {\n                // $('#newmap .close').show()\n            });\n            $('.overlay').fadeIn('fast');\n            $('#newmap input').focus();\n            $('button#addmap').fadeOut('fast');\n        },\n\n        closeNewMap: function() {\n            $('#newmap').slideUp('fast', function() {\n                // $('#newmap .close').hide()\n            });\n            $('.overlay').fadeOut('fast');\n            $('button#addmap').fadeIn('fast');\n        },\n\n        createMapping: function() {\n            var title = $.trim($('#newmap input').val());\n            if (!title) {\n                return false\n            }\n            this.collection.create({\n                title: title\n            });\n        },\n\n"],[0,"    "]],"start1":1123,"start2":1123,"length1":810,"length2":8}]],"length":1445,"saved":false}
{"ts":1352794192865,"patch":[[{"diffs":[[0,"\": \""],[-1,"openNewMap"],[1,"publish"],[0,"\",\n "]],"start1":865,"start2":865,"length1":18,"length2":15}]],"length":1442,"saved":false}
{"ts":1352794198258,"patch":[[{"diffs":[[0,"h\",\n"],[-1,"            \"keypress input\": \"captureKey\",\n            \"click #newmap .close\": \"closeNewMap\",\n            \"click button#savemap\": \"createMapping\"\n"],[0,"    "]],"start1":875,"start2":875,"length1":155,"length2":8}]],"length":1295,"saved":false}
{"ts":1352794208804,"patch":[[{"diffs":[[0,") {\n        },\n\n"],[1,"        publish: function() {\n        },\n    \n"],[0,"        captureK"]],"start1":961,"start2":961,"length1":32,"length2":78}]],"length":1341,"saved":false}
{"ts":1352794218818,"patch":[[{"diffs":[[0,"        "],[1,"/*"],[0,"render: "]],"start1":936,"start2":936,"length1":16,"length2":18},{"diffs":[[0,"n() {\n        },"],[1,"*/"],[0,"\n\n        publis"]],"start1":961,"start2":961,"length1":32,"length2":34}]],"length":1345,"saved":false}
{"ts":1352794243130,"patch":[[{"diffs":[[0,"    var "],[-1,"Mapping"],[1,"Shop"],[0,"List = B"]],"start1":431,"start2":431,"length1":23,"length2":20},{"diffs":[[0," model: "],[-1,"Mapping"],[1,"Shop"],[0,",\n      "]],"start1":486,"start2":486,"length1":23,"length2":20},{"diffs":[[0,"     url: '/"],[-1,"mapping"],[1,"shop"],[0,"s'\n    });\n "]],"start1":503,"start2":503,"length1":31,"length2":28}]],"length":1336,"saved":false}
{"ts":1352794247996,"patch":[[{"diffs":[[0,"    var "],[-1,"Mapping"],[1,"Shop"],[0," = Backb"]],"start1":164,"start2":164,"length1":23,"length2":20}]],"length":1333,"saved":false}
{"ts":1352794255539,"patch":[[{"diffs":[[0,": '/"],[-1,"mapping"],[1,"shop"],[0,"s'\n "]],"start1":246,"start2":246,"length1":15,"length2":12}]],"length":1330,"saved":false}
{"ts":1352794285109,"patch":[[{"diffs":[[0,"on: new "],[-1,"Mapping"],[1,"Shop"],[0,"List\n   "]],"start1":1290,"start2":1290,"length1":23,"length2":20}]],"length":1327,"saved":false}
{"ts":1352794297150,"patch":[[{"diffs":[[0,"w = new "],[-1,"MyMappings"],[1,"Publish"],[0,"View({\n "]],"start1":1249,"start2":1249,"length1":26,"length2":23}]],"length":1324,"saved":false}
{"ts":1352794301610,"patch":[[{"diffs":[[0,"    var "],[-1,"MyMappings"],[1,"Publish"],[0,"View = B"]],"start1":735,"start2":735,"length1":26,"length2":23}]],"length":1321,"saved":false}
{"ts":1352794344526,"patch":[[{"diffs":[[0,"    var "],[-1,"Poi"],[1,"Comme"],[0,"nt = Bac"]],"start1":302,"start2":302,"length1":19,"length2":21}]],"length":1323,"saved":false}
{"ts":1352794349485,"patch":[[{"diffs":[[0,"    var "],[-1,"Poi"],[1,"Comme"],[0,"ntList ="]],"start1":577,"start2":577,"length1":19,"length2":21}]],"length":1325,"saved":false}
{"ts":1352794369611,"patch":[[{"diffs":[[0," model: "],[-1,"Poi"],[1,"Comme"],[0,"nt\n    }"]],"start1":635,"start2":635,"length1":19,"length2":21}]],"length":1327,"saved":false}
{"ts":1352794415981,"patch":[[{"diffs":[[0,"    var "],[-1,"View"],[1,"Publish"],[0," = new P"]],"start1":1241,"start2":1241,"length1":20,"length2":23}]],"length":1330,"saved":false}
{"ts":1352794443132,"patch":[[{"diffs":[[0,"ick "],[-1,"button#addmap"],[1,"a#publish-btn"],[0,"\": \""]],"start1":836,"start2":836,"length1":21,"length2":21}]],"length":1330,"saved":false}
{"ts":1352794469097,"patch":[[{"diffs":[[0," $('"],[-1,"#mis-mapas"],[1,"section#publish"],[0,"').g"]],"start1":717,"start2":717,"length1":18,"length2":23}]],"length":1335,"saved":false}
{"ts":1352794496485,"patch":[[{"diffs":[[0,"h: function() {\n"],[1,"            console.log('publish')\n"],[0,"        },\n    \n"]],"start1":988,"start2":988,"length1":32,"length2":67}]],"length":1370,"saved":false}
{"ts":1352794675379,"patch":[[{"diffs":[[0,"blish: function("],[1,"e"],[0,") {\n"],[1,"            var data = PublishForm.getValidData();\n            if\n"],[0,"            cons"]],"start1":984,"start2":984,"length1":36,"length2":103}]],"length":1437,"saved":false}
{"ts":1352794685613,"patch":[[{"diffs":[[0,"      if"],[-1,"\n"],[1,"(data) {\n    "],[0,"        "]],"start1":1062,"start2":1062,"length1":17,"length2":29},{"diffs":[[0,"blish')\n"],[1,"            }\n"],[0,"        "]],"start1":1110,"start2":1110,"length1":16,"length2":30}]],"length":1463,"saved":false}
{"ts":1352794703044,"patch":[[{"diffs":[[0," if(data) {\n"],[1,"                this.collection.create(data);\n"],[0,"            "]],"start1":1067,"start2":1067,"length1":24,"length2":70}]],"length":1509,"saved":false}
{"ts":1352794705122,"patch":[[{"diffs":[[0,"a);\n"],[-1,"                console.log('publish')\n"],[0,"    "]],"start1":1121,"start2":1121,"length1":47,"length2":8}]],"length":1470,"saved":false}
{"ts":1352794722200,"patch":[[{"diffs":[[0,"ate(data"],[1,", {\n                    success: function() {\n                    }\n                }"],[0,");\n     "]],"start1":1114,"start2":1114,"length1":16,"length2":101}]],"length":1555,"saved":false}
{"ts":1352794730419,"patch":[[{"diffs":[[0,"s: function() {\n"],[1,"                        console.log('ok');\n"],[0,"                "]],"start1":1152,"start2":1152,"length1":32,"length2":75}]],"length":1598,"saved":false}
{"ts":1352794991762,"patch":[[{"diffs":[[0,"            "],[1,"/*"],[0,"this.collect"]],"start1":1083,"start2":1083,"length1":24,"length2":26},{"diffs":[[0,"         });"],[1,"*/"],[0,"\n           "]],"start1":1242,"start2":1242,"length1":24,"length2":26}]],"length":1602,"saved":false}
{"ts":1352794999330,"patch":[[{"diffs":[[0," if(data) {\n"],[1,"                console.log(data);\n"],[0,"            "]],"start1":1067,"start2":1067,"length1":24,"length2":59}]],"length":1637,"saved":false}
{"ts":1352795462157,"patch":[[{"diffs":[[0,": function(e) {\n"],[1,"            console.log('oe')\n"],[0,"            var "]],"start1":989,"start2":989,"length1":32,"length2":62}]],"length":1667,"saved":false}
{"ts":1352795974238,"patch":[[{"diffs":[[0,"\n               "],[1," //"],[0," console.log(dat"]],"start1":1108,"start2":1108,"length1":32,"length2":35}]],"length":1670,"saved":false}
{"ts":1352795976219,"patch":[[{"diffs":[[0,"        "],[-1,"/*"],[0,"this.col"]],"start1":1155,"start2":1155,"length1":18,"length2":16}]],"length":1668,"saved":false}
{"ts":1352795978212,"patch":[[{"diffs":[[0,"     });"],[-1,"*/"],[0,"\n       "]],"start1":1312,"start2":1312,"length1":18,"length2":16}]],"length":1666,"saved":false}
{"ts":1352795990110,"patch":[[{"diffs":[[0,"ccess: function("],[1,"a, b"],[0,") {\n            "]],"start1":1216,"start2":1216,"length1":32,"length2":36},{"diffs":[[0,"('ok');\n"],[1,"                        console.log(a);\n                        console.log(b);\n"],[0,"        "]],"start1":1275,"start2":1275,"length1":16,"length2":96}]],"length":1750,"saved":false}
{"ts":1352796351102,"patch":[[{"diffs":[[0,"  });\n \n"],[1,"    var ShopsView = Backbone.View.extend({\n    \n    "],[0,"\n    }\n}"]],"start1":1732,"start2":1732,"length1":16,"length2":68}]],"length":1802,"saved":false}
{"ts":1352796354604,"patch":[[{"diffs":[[0,"ew.extend({\n"],[1,"    });\n"],[0,"    \n    \n  "]],"start1":1771,"start2":1771,"length1":24,"length2":32}]],"length":1810,"saved":false}
{"ts":1352796367947,"patch":[[{"diffs":[[0,"ew.extend({\n"],[1,"        initialize: function() {\n        }\n"],[0,"    });\n    "]],"start1":1771,"start2":1771,"length1":24,"length2":67}]],"length":1853,"saved":false}
{"ts":1352796493117,"patch":[[{"diffs":[[0,"e.View.extend({\n"],[1,"        el: $('section#shops'),\n        \n"],[0,"        initiali"]],"start1":1767,"start2":1767,"length1":32,"length2":73}]],"length":1894,"saved":false}
{"ts":1352796502425,"patch":[[{"diffs":[[0,"e: function() {\n"],[1,"        },\n        \n        render: function() {\n"],[0,"        }\n    })"]],"start1":1841,"start2":1841,"length1":32,"length2":81}]],"length":1943,"saved":false}
{"ts":1352796513393,"patch":[[{"diffs":[[0,"r: function() {\n"],[1,"            this.collection.fetch();\n"],[0,"        }\n    })"]],"start1":1890,"start2":1890,"length1":32,"length2":69}]],"length":1980,"saved":false}
{"ts":1352796558640,"patch":[[{"diffs":[[0,"n.fetch("],[1,"{\n                success: function(coll, data) {\n                    $('ul.mappings').empty();\n                    data.forEach(function(item) {\n                        item.id = item._id;\n                        dust.render('mapping_item', item, function(err, html) {\n                            $('ul.mappings').append(html);\n                        });\n                    });\n                }"],[0,");\n     "]],"start1":1932,"start2":1932,"length1":16,"length2":414}]],"length":2378,"saved":false}
{"ts":1352796596840,"patch":[[{"diffs":[[0,"     $('"],[-1,"ul.mappings"],[1,"section#shops ul"],[0,"').empty"]],"start1":2005,"start2":2005,"length1":27,"length2":32}]],"length":2383,"saved":false}
{"ts":1352796614724,"patch":[[{"diffs":[[0,"render('"],[-1,"mapping"],[1,"shop"],[0,"_item', "]],"start1":2164,"start2":2164,"length1":23,"length2":20}]],"length":2380,"saved":false}
{"ts":1352796628167,"patch":[[{"diffs":[[0," $('"],[-1,"ul.mappings"],[1,"section#shops ul"],[0,"').a"]],"start1":2239,"start2":2239,"length1":19,"length2":24}]],"length":2385,"saved":false}
{"ts":1352796660511,"patch":[[{"diffs":[[0,"   });\n    \n"],[1,"    var Shops = new Backbone.View.extend({\n    });\n    \n"],[0,"    \n    }\n}"]],"start1":2359,"start2":2359,"length1":24,"length2":80}]],"length":2441,"saved":false}
{"ts":1352796671774,"patch":[[{"diffs":[[0,"ew.extend({\n"],[1,"        collection: new ShopList\n"],[0,"    });\n    "]],"start1":2402,"start2":2402,"length1":24,"length2":57}]],"length":2474,"saved":false}
{"ts":1352796687432,"patch":[[{"diffs":[[0,"e: function() {\n"],[1,"            this.render();\n"],[0,"        },\n     "]],"start1":1841,"start2":1841,"length1":32,"length2":59}]],"length":2501,"saved":false}
{"ts":1352796692210,"patch":[[{"diffs":[[0,"#shops')"],[1,".el()"],[0,",\n      "]],"start1":1805,"start2":1805,"length1":16,"length2":21}]],"length":2506,"saved":false}
{"ts":1352796731568,"patch":[[{"diffs":[[0,"               }"],[-1,");\n"],[1,"\n    "],[0,"        }\n    })"]],"start1":2361,"start2":2361,"length1":35,"length2":37},{"diffs":[[0," }\n            }"],[1,");"],[0,"\n    });\n    \n  "]],"start1":2375,"start2":2375,"length1":32,"length2":34}]],"length":2510,"saved":false}
{"ts":1352796737528,"patch":[[{"diffs":[[0,"        });\n"],[1,"        }\n"],[0,"    });\n    "]],"start1":2382,"start2":2382,"length1":24,"length2":34}]],"length":2520,"saved":false}
{"ts":1352796791024,"patch":[[{"diffs":[[0,"shops')."],[-1,"el"],[1,"get"],[0,"(),\n    "]],"start1":1806,"start2":1806,"length1":18,"length2":19}]],"length":2521,"saved":false}
{"ts":1352796927274,"patch":[[{"diffs":[[0,"n(coll, data) {\n"],[1,"                    console.log('ahhhhh')\n"],[0,"                "]],"start1":2007,"start2":2007,"length1":32,"length2":74},{"diffs":[[0,"            });\n"],[1,"                },\n                error: function() {\n                    console.log('puta!')\n"],[0,"                "]],"start1":2387,"start2":2387,"length1":32,"length2":128}]],"length":2659,"saved":false}
{"ts":1352796954673,"patch":[[{"diffs":[[0,"r: function() {\n"],[1,"            console.log('epa pues!')\n            console.log(this.collection)\n"],[0,"            this"]],"start1":1923,"start2":1923,"length1":32,"length2":110}]],"length":2737,"saved":false}
{"ts":1352796986786,"patch":[[{"diffs":[[0,"s = new "],[-1,"Backbone.View.extend"],[1,"ShopsView"],[0,"({\n     "]],"start1":2646,"start2":2646,"length1":36,"length2":25}]],"length":2726,"saved":false}
{"ts":1352797102709,"patch":[[{"diffs":[[0,"                "],[1,"/*"],[0,"$('section#shops"]],"start1":2147,"start2":2147,"length1":32,"length2":34},{"diffs":[[0,"             });"],[1,"*/"],[0,"\n               "]],"start1":2466,"start2":2466,"length1":32,"length2":34}]],"length":2730,"saved":false}
{"ts":1352797144260,"patch":[[{"diffs":[[0,"        "],[-1,"/*"],[0,"$('secti"]],"start1":2155,"start2":2155,"length1":18,"length2":16},{"diffs":[[0,"     });"],[-1,"*/"],[0,"\n       "]],"start1":2472,"start2":2472,"length1":18,"length2":16}]],"length":2726,"saved":false}
{"ts":1352797171375,"patch":[[{"diffs":[[0,"hhhhh')\n"],[1,"                    console.log(data)\n"],[0,"        "]],"start1":2135,"start2":2135,"length1":16,"length2":54}]],"length":2764,"saved":false}
{"ts":1352797198510,"patch":[[{"diffs":[[0,") {\n"],[-1,"                    console.log('ahhhhh')\n                    console.log(data)\n"],[0,"    "]],"start1":2097,"start2":2097,"length1":88,"length2":8}]],"length":2684,"saved":false}
{"ts":1352797219813,"patch":[[{"diffs":[[0,"rr, html) {\n"],[1,"                            console.log(err)\n                            console.log(html)\n"],[0,"            "]],"start1":2311,"start2":2311,"length1":24,"length2":115}]],"length":2775,"saved":false}
{"ts":1352797458799,"patch":[[{"diffs":[[0,") {\n"],[-1,"                            console.log(err)\n                            console.log(html)\n"],[0,"    "]],"start1":2319,"start2":2319,"length1":99,"length2":8}]],"length":2684,"saved":false}
{"ts":1352797480064,"patch":[[{"diffs":[[0,"ps ul')."],[-1,"a"],[0,"p"],[1,"re"],[0,"pend(htm"]],"start1":2365,"start2":2365,"length1":18,"length2":19}]],"length":2685,"saved":false}
{"ts":1352797566013,"patch":[[{"diffs":[[0,") {\n"],[-1,"            console.log('epa pues!')\n            console.log(this.collection)\n"],[0,"    "]],"start1":1935,"start2":1935,"length1":86,"length2":8}]],"length":2607,"saved":false}
{"ts":1352797583959,"patch":[[{"diffs":[[0,"    "],[-1,"console.log('ok');\n                        console.log(a);\n                        console.log(b);"],[1,"Shops.render()"],[0,"\n   "]],"start1":1260,"start2":1260,"length1":106,"length2":22}]],"length":2523,"saved":false}
{"ts":1352798161971,"patch":[[{"diffs":[[0,"     }\n        }"],[1,",\n        \n        photoUpload: function() {\n            var view = this;\n            \n            this.$el.find('.image-upload .control a').click(function(e) {\n                e.preventDefault();\n                $(this).blur();\n                \n                if ($(this).hasClass('cancel')) {\n                    view.cancelUpload();\n                }\n                if ($(this).hasClass('skip')) {\n                    view.skipCurrentUpload();\n                }\n            });\n            \n            $(\"#upload\").html5_upload({\n                url: '/mappings/'+this.mapping_id+'/points/'+this.point_id+'/image',\n                sendBoundary: window.FormData || $.browser.mozilla,\n                onStart: function(event, total) {\n                    // view.__progress = 0;\n                    //$('.meter > span').width(0);\n                    //$('.meter > span').removeClass('stop')\n                    \n                    var check = confirm(\"Está subiendo un total de \" + total + \" imágenes. ¿Desea continuar?\");\n                    if (check) {\n                        $('.image-upload').find('.control p span.index').text(' 1');\n                        $('.image-upload').find('.control p span.total').text(total);\n                        $('#addphoto').fadeOut(function() {\n                            $('.image-upload').slideDown();\n                        });\n                    }\n                    return check;\n                },\n                onStartOne: function(event, name, number, total) {\n                    view.__progress = 0;\n                    view.__uploading = true;\n                    $('.meter > span').removeClass('stop');\n                    $('.image-upload').find('.control p span.index').text(' ' + (number + 1));\n                    view.startProgressBar();\n                    return true;\n                },\n                onProgress: function(event, progress, name, number, total) {\n                    view.__progress = parseFloat((progress*100).toString().slice(0,5));\n                },\n                onFinish: function(event, response, name, number, total) {\n                    $('#addphoto').fadeIn();\n                    $('.image-upload').slideUp(function() {\n                        view.refresh()\n                    });\n                    view.__uploading = false;\n                },\n                onError: function(event, name, error) {\n                    alert('error while uploading file ' + name);\n                }\n            })\n        },"],[0,"\n    });\n\n    va"]],"start1":1551,"start2":1551,"length1":32,"length2":2548}]],"length":5039,"saved":false}
{"ts":1352798178591,"patch":[[{"diffs":[[0,"            "],[1,"/*"],[0,"this.$el.fin"]],"start1":1654,"start2":1654,"length1":24,"length2":26},{"diffs":[[0,"\n            });"],[1,"*/"],[0,"\n            \n  "]],"start1":2035,"start2":2035,"length1":32,"length2":34}]],"length":5043,"saved":false}
{"ts":1352798192067,"patch":[[{"diffs":[[0," url: '/"],[-1,"mapping"],[1,"shop"],[0,"s/'+this"]],"start1":2122,"start2":2122,"length1":23,"length2":20},{"diffs":[[0,"his."],[-1,"mapping"],[1,"shop"],[0,"_id+"]],"start1":2139,"start2":2139,"length1":15,"length2":12}]],"length":5037,"saved":false}
{"ts":1352798230992,"patch":[[{"diffs":[[0,"d+'/"],[-1,"points/'+this.point_id+'/"],[1,"logo_"],[0,"imag"]],"start1":2149,"start2":2149,"length1":33,"length2":13}]],"length":5017,"saved":false}
{"ts":1352798262738,"patch":[[{"diffs":[[0,"            "],[1,"/*"],[0,"var check = "]],"start1":2469,"start2":2469,"length1":24,"length2":26},{"diffs":[[0,"n check;"],[1,"*/\n                    return true;"],[0,"\n       "]],"start1":2974,"start2":2974,"length1":16,"length2":51}]],"length":5054,"saved":false}
{"ts":1352798293013,"patch":[[{"diffs":[[0,"                "],[1," //"],[0," $('.image-uploa"]],"start1":3253,"start2":3253,"length1":32,"length2":35}]],"length":5057,"saved":false}
{"ts":1352798336692,"patch":[[{"diffs":[[0,") {\n"],[-1,"                    $('#addphoto').fadeIn();\n                    $('.image-upload').slideUp(function() {\n                        view.refresh()\n                    });\n"],[0,"    "]],"start1":3700,"start2":3700,"length1":176,"length2":8}]],"length":4889,"saved":false}
{"ts":1352798382793,"patch":[[{"diffs":[[0,"\n        },\n"],[1,"        \n        startProgressBar: function() {\n            $('.meter > span').width(0);\n            $('.meter > span').removeClass('stop')\n\n            var view = this;\n            function go() {\n                var w = view.__progress + '%';\n                if (/*view.__progress == 100 || */!view.__uploading) { return }\n                $(\".meter > span\").animate({\n                    width: w\n                }, 100, go);\n            }\n            go()\n        },\n"],[0,"    });\n\n   "]],"start1":3922,"start2":3922,"length1":24,"length2":494}]],"length":5359,"saved":false}
{"ts":1352798385381,"patch":[[{"diffs":[[0,"()\n        }"],[-1,","],[0,"\n    });\n\n  "]],"start1":4390,"start2":4390,"length1":25,"length2":24}]],"length":5358,"saved":false}
{"ts":1352798559955,"patch":[[{"diffs":[[0,"e: function() {\n"],[1,"            this.photoUpload();\n"],[0,"        },\n\n    "]],"start1":901,"start2":901,"length1":32,"length2":64}]],"length":5390,"saved":false}
{"ts":1352799492035,"patch":[[{"diffs":[[0,"ion(a, b) {\n"],[1,"                        console.log(b)\n"],[0,"            "]],"start1":1260,"start2":1260,"length1":24,"length2":63}]],"length":5429,"saved":false}
{"ts":1352799549870,"patch":[[{"diffs":[[0,"ole.log("],[-1,"b"],[1,"a"],[0,")\n      "]],"start1":1300,"start2":1300,"length1":17,"length2":17}]],"length":5429,"saved":false}
{"ts":1352800982999,"patch":[[{"diffs":[[0,"  go()\n        }"],[1,",\n        \n        addPhoto: function() {\n            $('.media-image :file').click();\n        },\n"],[0,"\n    });\n\n    va"]],"start1":4457,"start2":4457,"length1":32,"length2":130}]],"length":5527,"saved":false}
{"ts":1352800992835,"patch":[[{"diffs":[[0," $('"],[-1,".media-image "],[0,":fil"]],"start1":4526,"start2":4526,"length1":21,"length2":8}]],"length":5514,"saved":false}
{"ts":1352801027043,"patch":[[{"diffs":[[0,"blish\",\n"],[1,"            'click #addphoto': 'addPhoto'\n"],[0,"        "]],"start1":864,"start2":864,"length1":16,"length2":58}]],"length":5556,"saved":false}
{"ts":1352801031963,"patch":[[{"diffs":[[0,"o': 'add"],[-1,"Phot"],[1,"Log"],[0,"o'\n     "]],"start1":899,"start2":899,"length1":20,"length2":19}]],"length":5555,"saved":false}
{"ts":1352801040144,"patch":[[{"diffs":[[0,"ick #add"],[-1,"phot"],[1,"log"],[0,"o': 'add"]],"start1":887,"start2":887,"length1":20,"length2":19}]],"length":5554,"saved":false}
{"ts":1352801343963,"patch":[[{"diffs":[[0," add"],[-1,"Phot"],[1,"Log"],[0,"o: f"]],"start1":4531,"start2":4531,"length1":12,"length2":11}]],"length":5553,"saved":false}
{"ts":1352801388122,"patch":[[{"diffs":[[0,".photoUpload();\n"],[1,"            \n            // Hide file input\n            var wrapper = $('<div/>').css({height:0,width:0,'overflow':'hidden'});\n            var fileInput = $(':file').wrap(wrapper);\n            fileInput.change(function(){\n                var $this = $(this);\n                $('#file').text($this.val());\n            });\n"],[0,"        },\n\n    "]],"start1":973,"start2":973,"length1":32,"length2":353}]],"length":5874,"saved":false}
{"ts":1352802831109,"patch":[[{"diffs":[[0,"    "],[-1,"\n    }\n"],[1,"var ShopView = Backbone.View.extend({\n    });\n    \n}"],[0,"});"]],"start1":5860,"start2":5860,"length1":14,"length2":59}]],"length":5919,"saved":false}
{"ts":1352802847487,"patch":[[{"diffs":[[0," ShopView = "],[1,"("],[0,"Backbone.Vie"]],"start1":5867,"start2":5867,"length1":24,"length2":25},{"diffs":[[0,"xtend({\n    "],[-1,"}"],[1,"    \n    })"],[0,");\n    \n}});"]],"start1":5895,"start2":5895,"length1":25,"length2":35}]],"length":5930,"saved":false}
{"ts":1352802857341,"patch":[[{"diffs":[[0,"opView ="],[1," new"],[0," (Backbo"]],"start1":5870,"start2":5870,"length1":16,"length2":20},{"diffs":[[0,"({\n        \n"],[1,"        \n"],[0,"    }));\n   "]],"start1":5904,"start2":5904,"length1":24,"length2":33}]],"length":5943,"saved":false}
{"ts":1352802866039,"patch":[[{"diffs":[[0,"xtend({\n        "],[1,"initialize: function() {\n        }"],[0,"\n        \n    })"]],"start1":5899,"start2":5899,"length1":32,"length2":66}]],"length":5977,"saved":false}
{"ts":1352802872921,"patch":[[{"diffs":[[0,"e: function() {\n"],[1,"            console.log('shopbire')\n"],[0,"        }\n      "]],"start1":5924,"start2":5924,"length1":32,"length2":68}]],"length":6013,"saved":false}
{"ts":1352803570764,"patch":[[{"diffs":[[0,"    "],[-1,"console.log('shopbire')"],[0,"\n   "]],"start1":5948,"start2":5948,"length1":31,"length2":8},{"diffs":[[0,"      \n        }"],[1,","],[0,"\n        \n    })"]],"start1":5946,"start2":5946,"length1":32,"length2":33},{"diffs":[[0," },\n        "],[1,"render: function() {\n        }"],[0,"\n    }));\n  "]],"start1":5960,"start2":5960,"length1":24,"length2":54}]],"length":6021,"saved":false}
{"ts":1352803574545,"patch":[[{"diffs":[[0,"    \n        },\n"],[1,"        \n"],[0,"        render: "]],"start1":5948,"start2":5948,"length1":32,"length2":41}]],"length":6030,"saved":false}
{"ts":1352803694033,"patch":[[{"diffs":[[0,"r: function() {\n"],[1,"            $(\"section#front\").hide();\n            $(\"section#shop\").fadeIn('fast');\n            \n            this.model.fetch();\n"],[0,"        }\n    })"]],"start1":5986,"start2":5986,"length1":32,"length2":162}]],"length":6160,"saved":false}
{"ts":1352803703491,"patch":[[{"diffs":[[0,"el.fetch();\n"],[1,"        },\n        \n        load: function() {\n"],[0,"        }\n  "]],"start1":6120,"start2":6120,"length1":24,"length2":71}]],"length":6207,"saved":false}
{"ts":1352803937262,"patch":[[{"diffs":[[0,"rapper')"],[1,"\n                    .empty()\n                    .html(html)"],[0,";\n      "]],"start1":6236,"start2":6236,"length1":16,"length2":77}]],"length":6551,"saved":false}
{"ts":1352803997412,"patch":[[{"diffs":[[0,");\n    \n"],[1,"    // Backbone Router for Mappings\n    var ShopRouter = Backbone.Router.extend({\n        routes: {\n            \"mapping/:id\": \"getMappingById\",\n            \"mappings/:mapping_id/points/:point_id\": \"getPointById\",\n            \"mappings\": \"getMyMappings\"\n        },\n        getMappingById: function(id) {\n            MappingView.load(id);\n        },\n        getMyMappings: function() {\n            app.CardSlider.show('mis-mapas');\n        },\n        getPointById: function(mapping_id, point_id) {\n            PointView.getPointById(mapping_id, point_id, function() {\n                app.CardSlider.show('point');\n            })\n        }\n    });\n    new MappingRouter();\n    \n"],[0,"}});"]],"start1":6539,"start2":6539,"length1":12,"length2":688}]],"length":7227,"saved":false}
{"ts":1352804041411,"patch":[[{"diffs":[[0,"       \""],[-1,"mapping"],[1,"shop"],[0,"/:id\": \""]],"start1":6652,"start2":6652,"length1":23,"length2":20},{"diffs":[[0,"\"get"],[-1,"MappingById\",\n            \"mappings/:mapping_id/points/:point_id\": \"getPointById\",\n            \"mappings\": \"getMyMappings\""],[1,"ShopById\","],[0,"\n   "]],"start1":6671,"start2":6671,"length1":130,"length2":18},{"diffs":[[0,"     get"],[-1,"Mapping"],[1,"Shop"],[0,"ById: fu"]],"start1":6700,"start2":6700,"length1":23,"length2":20},{"diffs":[[0,"        "],[-1,"Mapping"],[1,"Shop"],[0,"View.loa"]],"start1":6737,"start2":6737,"length1":23,"length2":20}]],"length":7106,"saved":false}
{"ts":1352804049391,"patch":[[{"diffs":[[0,"d);\n"],[-1,"        },\n        getMyMappings: function() {\n            app.CardSlider.show('mis-mapas');\n        },\n        getPointById: function(mapping_id, point_id) {\n            PointView.getPointById(mapping_id, point_id, function() {\n                app.CardSlider.show('point');\n            })\n"],[0,"    "]],"start1":6760,"start2":6760,"length1":298,"length2":8}]],"length":6816,"saved":false}
{"ts":1352804059586,"patch":[[{"diffs":[[0,"    new "],[-1,"Mapping"],[1,"Shop"],[0,"Router()"]],"start1":6782,"start2":6782,"length1":23,"length2":20}]],"length":6813,"saved":false}
{"ts":1352804082552,"patch":[[{"diffs":[[0,"       \""],[1,"!"],[0,"shop/:id"]],"start1":6652,"start2":6652,"length1":16,"length2":17}]],"length":6814,"saved":false}
{"ts":1352804087622,"patch":[[{"diffs":[[0,"  \"!shop"],[1,"s"],[0,"/:id\": \""]],"start1":6657,"start2":6657,"length1":16,"length2":17}]],"length":6815,"saved":false}
{"ts":1352804089830,"patch":[[{"diffs":[[0,"hopById\""],[-1,","],[0,"\n       "]],"start1":6678,"start2":6678,"length1":17,"length2":16}]],"length":6814,"saved":false}
{"ts":1352804126482,"patch":[[{"diffs":[[0,"ccess: function("],[1,"d"],[0,") {\n"],[1,"                    console.log(d)\n"],[0,"                "]],"start1":6469,"start2":6469,"length1":36,"length2":72}]],"length":6850,"saved":false}
{"ts":1352804157979,"patch":[[{"diffs":[[0,"      \"!"],[1,"/"],[0,"shops/:i"]],"start1":6689,"start2":6689,"length1":16,"length2":17}]],"length":6851,"saved":false}
{"ts":1352804167535,"patch":[[{"diffs":[[0,"            "],[1,"console.log('hola')\n            //"],[0,"ShopView.loa"]],"start1":6771,"start2":6771,"length1":24,"length2":58}]],"length":6885,"saved":false}
{"ts":1352804191137,"patch":[[{"diffs":[[0,"    "],[-1,"console.log('hola')\n            //"],[0,"Shop"]],"start1":6779,"start2":6779,"length1":42,"length2":8}]],"length":6851,"saved":false}
{"ts":1352804242050,"patch":[[{"diffs":[[0,"tch("],[-1,"{\n                success: function(d) {\n                    console.log(d)\n                }\n            }"],[0,");\n "]],"start1":6445,"start2":6445,"length1":115,"length2":8}]],"length":6744,"saved":false}
{"ts":1352804263540,"patch":[[{"diffs":[[0," function(id) {\n"],[1,"            var view = ths;\n"],[0,"            this"]],"start1":6356,"start2":6356,"length1":32,"length2":60},{"diffs":[[0,"l.fetch("],[1,"{\n                success: function(d) {\n                    view.render()\n                }\n            }"],[0,");\n     "]],"start1":6469,"start2":6469,"length1":16,"length2":122}]],"length":6878,"saved":false}
{"ts":1352804266114,"patch":[[{"diffs":[[0,"iew = th"],[1,"i"],[0,"s;\n     "]],"start1":6389,"start2":6389,"length1":16,"length2":17}]],"length":6879,"saved":false}
{"ts":1352804281478,"patch":[[{"diffs":[[0,"_info', "],[-1,"shop"],[1,"this.model"],[0,", functi"]],"start1":6043,"start2":6043,"length1":20,"length2":26}]],"length":6885,"saved":false}
{"ts":1352804422345,"patch":[[{"diffs":[[0,"               \n"],[1,"                console.log(html)\n                \n"],[0,"                "]],"start1":6179,"start2":6179,"length1":32,"length2":83}]],"length":6936,"saved":false}
{"ts":1352804506837,"patch":[[{"diffs":[[0,"tion() {"],[1,"\n"],[0,"        "]],"start1":5993,"start2":5993,"length1":16,"length2":17},{"diffs":[[0,") {\n            "],[1,"console.log(this.model)"],[0,"\n            dus"]],"start1":5998,"start2":5998,"length1":32,"length2":55}]],"length":6960,"saved":false}
{"ts":1352804522243,"patch":[[{"diffs":[[0,") {\n"],[-1,"            console.log(this.model)\n"],[0,"    "]],"start1":5998,"start2":5998,"length1":44,"length2":8}]],"length":6924,"saved":false}
{"ts":1352804606025,"patch":[[{"diffs":[[0,"is.model"],[1,".toJSON()"],[0,", functi"]],"start1":6041,"start2":6041,"length1":16,"length2":25}]],"length":6933,"saved":false}
{"ts":1352804639971,"patch":[[{"diffs":[[0,"r: function() {\n"],[1,"            console.log(this.model.toJSON())\n"],[0,"            dust"]],"start1":5986,"start2":5986,"length1":32,"length2":77}]],"length":6978,"saved":false}
{"ts":1352805093943,"patch":[[{"diffs":[[0,"               \n"],[1,"                console.log(err)\n"],[0,"                "]],"start1":6221,"start2":6221,"length1":32,"length2":65}]],"length":7011,"saved":false}
{"ts":1352808265516,"patch":[[{"diffs":[[0,"        "],[-1,"console.log("],[1,"var data = "],[0,"this.mod"]],"start1":6006,"start2":6006,"length1":28,"length2":27},{"diffs":[[0,"toJSON()"],[-1,")"],[1,";\n            data = data.replace(/(http|https):\\/\\//, '');\n            "],[0,"\n       "]],"start1":6036,"start2":6036,"length1":17,"length2":88},{"diffs":[[0,"_info', "],[-1,"this.model.toJSON()"],[1,"data"],[0,", functi"]],"start1":6146,"start2":6146,"length1":35,"length2":20}]],"length":7066,"saved":false}
{"ts":1352808334480,"patch":[[{"diffs":[[0,"    data"],[1,".web = data.replace(/(http|https):\\/\\//, '');\n            data.fb = data.replace(/(http|https):\\/\\//, '');\n            data.twitter"],[0," = data."]],"start1":6054,"start2":6054,"length1":16,"length2":147}]],"length":7197,"saved":false}
{"ts":1352808345002,"patch":[[{"diffs":[[0,"data.web = data."],[1,"web."],[0,"replace(/(http|h"]],"start1":6058,"start2":6058,"length1":32,"length2":36},{"diffs":[[0," data.fb = data."],[1,"fb."],[0,"replace(/(http|h"]],"start1":6123,"start2":6123,"length1":32,"length2":35},{"diffs":[[0," = data."],[1,"twitter."],[0,"replace("]],"start1":6200,"start2":6200,"length1":16,"length2":24}]],"length":7212,"saved":false}
{"ts":1352808424657,"patch":[[{"diffs":[[0,"\n           "],[1," if(data.web)"],[0," data.web = "]],"start1":6045,"start2":6045,"length1":24,"length2":37},{"diffs":[[0,"\n           "],[1," if(data.fb)"],[0," data.fb = d"]],"start1":6124,"start2":6124,"length1":24,"length2":36},{"diffs":[[0,"\n           "],[1," if(data.twitter)"],[0," data.twitte"]],"start1":6200,"start2":6200,"length1":24,"length2":41}]],"length":7254,"saved":false}
{"ts":1352808498355,"patch":[[{"diffs":[[0,"ata."],[-1,"twitte"],[1,"flick"],[0,"r) data."],[-1,"twitte"],[1,"flick"],[0,"r = "]],"start1":6217,"start2":6217,"length1":28,"length2":26},{"diffs":[[0,"ata."],[-1,"twitte"],[1,"flick"],[0,"r.re"]],"start1":6244,"start2":6244,"length1":14,"length2":13}]],"length":7251,"saved":false}
{"ts":1352808552767,"patch":[[{"diffs":[[0,"   \n            "],[1,"if(data.web) data.web = data.web.replace(/(\\?*.)/, '');\n            if(data.fb) data.fb = data.fb.replace(/(http|https):\\/\\//, '');\n            if(data.flickr) data.flickr = data.flickr.replace(/(http|https):\\/\\//, '');\n\n"],[0,"dust.render('sho"]],"start1":6298,"start2":6298,"length1":32,"length2":253}]],"length":7472,"saved":false}
{"ts":1352808672340,"patch":[[{"diffs":[[0,"web."],[-1,"replace(/(\\?*.)/, '')"],[1,"split('?')[0]"],[0,";\n  "]],"start1":6343,"start2":6343,"length1":29,"length2":21},{"diffs":[[0,".fb."],[-1,"replace(/(http|https):\\/\\//, '')"],[1,"split('?')[0]"],[0,";\n  "]],"start1":6400,"start2":6400,"length1":40,"length2":21},{"diffs":[[0,"ckr."],[-1,"replace(/(http|https):\\/\\//, '')"],[1,"split('?')[0]"],[0,";\n\nd"]],"start1":6469,"start2":6469,"length1":40,"length2":21}]],"length":7426,"saved":false}
{"ts":1352810113301,"patch":[[{"diffs":[[0,"')[0];\n\n"],[1,"            "],[0,"dust.ren"]],"start1":6481,"start2":6481,"length1":16,"length2":28}]],"length":7438,"saved":false}
{"ts":1352810127036,"patch":[[{"diffs":[[0,"ps/:id\":"],[1," \"getShopById\",\n            \"!/c/:id\":"],[0," \"getSho"]],"start1":7288,"start2":7288,"length1":16,"length2":54}]],"length":7476,"saved":false}
{"ts":1352810138448,"patch":[[{"diffs":[[0,"/:id\": \""],[-1,"getShopById"],[1,"loadCategory"],[0,"\"\n      "]],"start1":7328,"start2":7328,"length1":27,"length2":28}]],"length":7477,"saved":false}
{"ts":1352810163006,"patch":[[{"diffs":[[0,"ad(id);\n"],[1,"        },\n        loadCategory: function(cat) {\n"],[0,"        "]],"start1":7420,"start2":7420,"length1":16,"length2":65}]],"length":7526,"saved":false}
{"ts":1352810195785,"patch":[[{"diffs":[[0,"tion(cat) {\n"],[1,"            Shops.loadCategory(cat);\n"],[0,"        }\n  "]],"start1":7465,"start2":7465,"length1":24,"length2":61}]],"length":7563,"saved":false}
{"ts":1352810218482,"patch":[[{"diffs":[[0,"            });\n"],[1,"        },\n        \n        loadCategory: function() {\n"],[0,"        }\n    })"]],"start1":5743,"start2":5743,"length1":32,"length2":87}]],"length":7618,"saved":false}
{"ts":1352810407488,"patch":[[{"diffs":[[0,"    "],[-1,"this.render();\n        },"],[1,"var view = this;\n            this.collection.fetch({"],[0,"\n   "]],"start1":5138,"start2":5138,"length1":33,"length2":60},{"diffs":[[0,"h({\n        "],[-1,"\n"],[0,"        "],[-1,"render"],[1,"success"],[0,": function()"]],"start1":5191,"start2":5191,"length1":39,"length2":39},{"diffs":[[0,"ccess: function("],[-1,") {\n"],[1,"coll, data) {\n    "],[0,"            this"]],"start1":5213,"start2":5213,"length1":36,"length2":50},{"diffs":[[0,"        "],[1,"    "],[0,"this."],[-1,"collection.fetch({"],[1,"render();\n        },"],[0,"\n       "]],"start1":5251,"start2":5251,"length1":39,"length2":45},{"diffs":[[0," },\n        "],[1,"\n"],[0,"        "],[-1,"success"],[1,"render"],[0,": function(c"]],"start1":5285,"start2":5285,"length1":39,"length2":39},{"diffs":[[0,"r: function("],[-1,"coll, data"],[0,") {\n        "]],"start1":5311,"start2":5311,"length1":34,"length2":24},{"diffs":[[0,"egory: function("],[-1,") {"],[1,"cat) {\n            this.collection.fetch({\n                data: {\n                    category: cat\n                },\n                success: function() {\n                }\n            });"],[0,"\n        }\n    }"]],"start1":5831,"start2":5831,"length1":35,"length2":223}]],"length":7843,"saved":false}
{"ts":1352810419588,"patch":[[{"diffs":[[0,"        "],[-1,"this"],[1,"view"],[0,".render("]],"start1":5255,"start2":5255,"length1":20,"length2":20},{"diffs":[[0,"w.render();\n"],[1,"                }\n            });\n"],[0,"        },\n "]],"start1":5266,"start2":5266,"length1":24,"length2":58}]],"length":7877,"saved":false}
{"ts":1352810465693,"patch":[[{"diffs":[[0,"            "],[-1,"        "],[0,"$('section#s"]],"start1":5361,"start2":5361,"length1":32,"length2":24},{"diffs":[[0,"            "],[-1,"    "],[-1,"    "],[0,"data.forEach"]],"start1":5404,"start2":5404,"length1":32,"length2":24},{"diffs":[[0,"ion(item) {\n"],[-1,"        "],[0,"            "]],"start1":5434,"start2":5434,"length1":32,"length2":24},{"diffs":[[0,"            "],[-1,"        "],[0,"dust.render("]],"start1":5486,"start2":5486,"length1":32,"length2":24},{"diffs":[[0,"            "],[-1,"        "],[0,"$('section#s"]],"start1":5559,"start2":5559,"length1":32,"length2":24},{"diffs":[[0,"    "],[-1,"       "],[-1," "],[0,"});\n"],[-1,"                    });\n                },\n                error: function() {\n                    console.log('puta!')\n                }\n"],[0,"    "]],"start1":5620,"start2":5620,"length1":158,"length2":12}]],"length":7691,"saved":false}
{"ts":1352810663222,"patch":[[{"diffs":[[0,"        "],[-1,"data"],[1,"this.collection.models"],[0,".forEach"]],"start1":5408,"start2":5408,"length1":20,"length2":38}]],"length":7709,"saved":false}
{"ts":1352810672286,"patch":[[{"diffs":[[0,"ion(item) {\n"],[1,"                item = item.toJSON();\n"],[0,"            "]],"start1":5452,"start2":5452,"length1":24,"length2":62}]],"length":7747,"saved":false}
{"ts":1352810728126,"patch":[[{"diffs":[[0,"function(cat) {\n"],[1,"            var view = this;\n"],[0,"            this"]],"start1":5742,"start2":5742,"length1":32,"length2":61},{"diffs":[[0,"s: function() {\n"],[1,"                    view.render()\n"],[0,"                "]],"start1":5922,"start2":5922,"length1":32,"length2":66}]],"length":7810,"saved":false}
{"ts":1352810769223,"patch":[[{"diffs":[[0,"  \"!/c/:"],[-1,"id"],[1,"cat"],[0,"\": \"load"]],"start1":7569,"start2":7569,"length1":18,"length2":19}]],"length":7811,"saved":false}
{"ts":1352811900025,"patch":[[{"diffs":[[0," a#p"],[-1,"ublish"],[1,"lus"],[0,"-btn\": \""],[-1,"publish"],[0,"\",\n "]],"start1":844,"start2":844,"length1":29,"length2":19}]],"length":7801,"saved":false}
{"ts":1352811918560,"patch":[[{"diffs":[[0," a#p"],[-1,"lus"],[1,"ublish"],[0,"-btn\": \""],[1,"publish"],[0,"\",\n "]],"start1":844,"start2":844,"length1":19,"length2":29}]],"length":7811,"saved":false}
{"ts":1352814332339,"patch":[[{"diffs":[[0,"s: function() {\n"],[1,"                    $(\"#categories\").find(\":contains(\"+cat+\")\")\n"],[0,"                "]],"start1":5922,"start2":5922,"length1":32,"length2":96}]],"length":7875,"saved":false}
{"ts":1352814347346,"patch":[[{"diffs":[[0,"            "],[1," var $cat ="],[0," $(\"#categor"]],"start1":5945,"start2":5945,"length1":24,"length2":35}]],"length":7886,"saved":false}
{"ts":1352814349451,"patch":[[{"diffs":[[0,"cat+\")\")"],[1,";"],[0,"\n       "]],"start1":6004,"start2":6004,"length1":16,"length2":17}]],"length":7887,"saved":false}
{"ts":1352814355768,"patch":[[{"diffs":[[0,"\"+cat+\")\");\n"],[1,"                    console.log($cat)\n"],[0,"            "]],"start1":6002,"start2":6002,"length1":24,"length2":62}]],"length":7925,"saved":false}
{"ts":1352814390650,"patch":[[{"diffs":[[0,"log($cat"],[1,".get(0)"],[0,")\n      "]],"start1":6042,"start2":6042,"length1":16,"length2":23}]],"length":7932,"saved":false}
{"ts":1352814470506,"patch":[[{"diffs":[[0,"ccess: function("],[1,"data"],[0,") {\n            "]],"start1":5918,"start2":5918,"length1":32,"length2":36}]],"length":7936,"saved":false}
{"ts":1352814477605,"patch":[[{"diffs":[[0,"unction(data) {\n"],[1,"                    console.log(data._id)\n"],[0,"                "]],"start1":5926,"start2":5926,"length1":32,"length2":74}]],"length":7978,"saved":false}
{"ts":1352814614902,"patch":[[{"diffs":[[0,") {\n"],[-1,"                    console.log(data._id)\n"],[0,"    "]],"start1":5938,"start2":5938,"length1":50,"length2":8}]],"length":7936,"saved":false}
{"ts":1352814627171,"patch":[[{"diffs":[[0,"\"+cat+\")\");\n"],[1,"                    console.log(\":contains(\"+cat+\")\");\n"],[0,"            "]],"start1":6006,"start2":6006,"length1":24,"length2":79}]],"length":7991,"saved":false}
{"ts":1352814984822,"patch":[[{"diffs":[[0,"    "],[-1," var $cat ="],[0," $(\""],[-1,"#"],[1,"."],[0,"categor"],[-1,"ies\").find(\":contains(\"+cat+\")\");\n                    console.log(\":contains(\"+cat+\")\");\n                    console.log($cat.get(0))"],[1,"y-item a\").each(function() {\n                    });"],[0,"\n   "]],"start1":5957,"start2":5957,"length1":164,"length2":72}]],"length":7899,"saved":false}
{"ts":1352815011195,"patch":[[{"diffs":[[0,"ch(function() {\n"],[1,"                        if ($(this).attr('href') == cat) {\n                        }\n"],[0,"                "]],"start1":5986,"start2":5986,"length1":32,"length2":117}]],"length":7984,"saved":false}
{"ts":1352815076681,"patch":[[{"diffs":[[0,") == cat) {\n"],[1,"                            $(this).closest('li').addClass('on');\n"],[0,"            "]],"start1":6049,"start2":6049,"length1":24,"length2":90}]],"length":8050,"saved":false}
{"ts":1352815127117,"patch":[[{"diffs":[[0,") == cat) {\n"],[1,"                            $(this).closest('ul').find('li.on').removeClass('on');\n"],[0,"            "]],"start1":6049,"start2":6049,"length1":24,"length2":107}]],"length":8133,"saved":false}
{"ts":1352815302708,"patch":[[{"diffs":[[0,"ch(function() {\n"],[1,"                        console.log($(this).attr('href'))\n                        console.log(cat)\n"],[0,"                "]],"start1":5986,"start2":5986,"length1":32,"length2":131}]],"length":8232,"saved":false}
{"ts":1352815365925,"patch":[[{"diffs":[[0,"        "],[-1,"console.log("],[1,"var href = "],[0,"$(this)."]],"start1":6018,"start2":6018,"length1":28,"length2":27},{"diffs":[[0,"ef')"],[-1,")\n                        console.log(cat)"],[1,".split('/').pop();"],[0,"\n   "]],"start1":6053,"start2":6053,"length1":50,"length2":26},{"diffs":[[0,"    if ("],[-1,"$(this).attr('"],[0,"href"],[-1,"')"],[0," == cat)"]],"start1":6096,"start2":6096,"length1":36,"length2":20}]],"length":8191,"saved":false}
{"ts":1352816940181,"patch":[[{"diffs":[[0,"ddLogo'\n"],[1,"            'click a.cerrar': 'addLogo'\n"],[0,"        "]],"start1":904,"start2":904,"length1":16,"length2":56}]],"length":8231,"saved":false}
{"ts":1352816945086,"patch":[[{"diffs":[[0,"logo': 'addLogo'"],[1,","],[0,"\n            'cl"]],"start1":895,"start2":895,"length1":32,"length2":33},{"diffs":[[0,"rrar': '"],[-1,"addLogo"],[1,"close"],[0,"'\n      "]],"start1":936,"start2":936,"length1":23,"length2":21}]],"length":8230,"saved":false}
{"ts":1352816955334,"patch":[[{"diffs":[[0,"  },*/\n\n"],[1,"        close: function() {\n        },\n\n"],[0,"        "]],"start1":1398,"start2":1398,"length1":16,"length2":56}]],"length":8270,"saved":false}
{"ts":1352816973361,"patch":[[{"diffs":[[0,"e: function() {\n"],[1,"            $(\"section#publish\").fadeOut();\n"],[0,"        },\n\n    "]],"start1":1418,"start2":1418,"length1":32,"length2":76}]],"length":8314,"saved":false}
{"ts":1352817024900,"patch":[[{"diffs":[[0," a.c"],[-1,"errar"],[1,"lose"],[0,"': '"]],"start1":931,"start2":931,"length1":13,"length2":12}]],"length":8313,"saved":false}
{"ts":1352817181580,"patch":[[{"diffs":[[0,");\n        }"],[1,",\n        \n        postComment: function() {\n            ]"],[0,"\n    }));\n  "]],"start1":7892,"start2":7892,"length1":24,"length2":82}]],"length":8371,"saved":false}
{"ts":1352817183446,"patch":[[{"diffs":[[0,"    "],[-1,"    ]"],[1,"}"],[0,"\n   "]],"start1":7953,"start2":7953,"length1":13,"length2":9}]],"length":8367,"saved":false}
{"ts":1352817226048,"patch":[[{"diffs":[[0,"    "],[-1,"\n                console.log(err)\n                console.log(html)\n"],[0,"    "]],"start1":7408,"start2":7408,"length1":76,"length2":8}]],"length":8299,"saved":false}
{"ts":1352817243121,"patch":[[{"diffs":[[0,"r: function() {\n"],[1,"            var view = this;\n"],[0,"            var "]],"start1":6735,"start2":6735,"length1":32,"length2":61}]],"length":8328,"saved":false}
{"ts":1352817389639,"patch":[[{"diffs":[[0,") {\n            "],[1,"$(\"a#post-comment\").live('click', function() {\n            })"],[0,"\n        },\n    "]],"start1":6685,"start2":6685,"length1":32,"length2":93}]],"length":8389,"saved":false}
{"ts":1352817391422,"patch":[[{"diffs":[[0,"{\n            })"],[1,";"],[0,"\n        },\n    "]],"start1":6746,"start2":6746,"length1":32,"length2":33}]],"length":8390,"saved":false}
{"ts":1352817400893,"patch":[[{"diffs":[[0,"lick', function("],[1,"e"],[0,") {\n"],[1,"                e.preventDefault();\n"],[0,"            });\n"]],"start1":6728,"start2":6728,"length1":36,"length2":73}]],"length":8427,"saved":false}
{"ts":1352817442260,"patch":[[{"diffs":[[0,"e: function() {\n"],[1,"            this.comments = function() {\n            }\n"],[0,"            $(\"a"]],"start1":6673,"start2":6673,"length1":32,"length2":87},{"diffs":[[0,"eventDefault();\n"],[1,"                \n"],[0,"            });\n"]],"start1":6824,"start2":6824,"length1":32,"length2":49}]],"length":8499,"saved":false}
{"ts":1352817448448,"patch":[[{"diffs":[[0," {\n            }"],[1,";\n            "],[0,"\n            $(\""]],"start1":6727,"start2":6727,"length1":32,"length2":46}]],"length":8513,"saved":false}
{"ts":1352817475985,"patch":[[{"diffs":[[0,"s = "],[-1,"function() {\n            }"],[1,"new CommentList"],[0,";\n  "]],"start1":6713,"start2":6713,"length1":34,"length2":23}]],"length":8502,"saved":false}
{"ts":1352817527756,"patch":[[{"diffs":[[0,"            });\n"],[1,"            \n            this.comments.fetch({\n            });\n"],[0,"        },\n     "]],"start1":7750,"start2":7750,"length1":32,"length2":95}]],"length":8565,"saved":false}
{"ts":1352817587213,"patch":[[{"diffs":[[0,"omments.fetch({\n"],[1,"                \n"],[0,"            });\n"]],"start1":7797,"start2":7797,"length1":32,"length2":49},{"diffs":[[0,"t: function() {\n"],[1,"            this.comments.create({\n                data: {\n                },\n                success: function() {\n                }\n            });\n"],[0,"        }\n    })"]],"start1":8148,"start2":8148,"length1":32,"length2":182}]],"length":8732,"saved":false}
{"ts":1352817631168,"patch":[[{"diffs":[[0,"s: function() {\n"],[1,"                    view.render();\n"],[0,"                "]],"start1":8264,"start2":8264,"length1":32,"length2":67}]],"length":8767,"saved":false}
{"ts":1352817637263,"patch":[[{"diffs":[[0,"t: function() {\n"],[1,"            var view = this;\n"],[0,"            this"]],"start1":8148,"start2":8148,"length1":32,"length2":61}]],"length":8796,"saved":false}
{"ts":1352817687221,"patch":[[{"diffs":[[0,"mentList"],[1,"({\n            })"],[0,";\n      "]],"start1":6724,"start2":6724,"length1":16,"length2":33}]],"length":8813,"saved":false}
{"ts":1352817699233,"patch":[[{"diffs":[[0,"tList({\n"],[1,"                url: '/comments'\n"],[0,"        "]],"start1":6727,"start2":6727,"length1":16,"length2":49}]],"length":8846,"saved":false}
{"ts":1352817716316,"patch":[[{"diffs":[[0," Comment"],[1,",\n        url: '/comments'"],[0,"\n    });"]],"start1":642,"start2":642,"length1":16,"length2":42}]],"length":8872,"saved":false}
{"ts":1352817728700,"patch":[[{"diffs":[[0,"lection "],[-1,"Mapping"],[1,"Shop"],[0,"List\n   "]],"start1":392,"start2":392,"length1":23,"length2":20},{"diffs":[[0,"ion "],[-1,"PointList"],[1,"Comments"],[0,"\n   "]],"start1":545,"start2":545,"length1":17,"length2":16}]],"length":8868,"saved":false}
{"ts":1352817731145,"patch":[[{"diffs":[[0," @Model "],[-1,"Mapping"],[1,"Shop"],[0,"\n     *\n"]],"start1":133,"start2":133,"length1":23,"length2":20}]],"length":8865,"saved":false}
{"ts":1352817737087,"patch":[[{"diffs":[[0,"iew "],[-1,"MyMappings"],[1,"Publish"],[0,"View"]],"start1":690,"start2":690,"length1":18,"length2":15}]],"length":8862,"saved":false}
{"ts":1352820106620,"patch":[[{"diffs":[[0,"                "],[1,"//"],[0,"console.log(a)\n "]],"start1":1779,"start2":1779,"length1":32,"length2":34},{"diffs":[[0,"            "],[1,"//"],[0,"Shops.render"]],"start1":1824,"start2":1824,"length1":24,"length2":26},{"diffs":[[0,"/Shops.render()\n"],[1,"                        location.href = '#!/shops/'+a.id;\n"],[0,"                "]],"start1":1837,"start2":1837,"length1":32,"length2":90}]],"length":8924,"saved":false}
{"ts":1352820164966,"patch":[[{"diffs":[[0,"ops/'+a.id;\n"],[1,"                        $('section#publish').fadeOut()\n"],[0,"            "]],"start1":1899,"start2":1899,"length1":24,"length2":79}]],"length":8979,"saved":false}
{"ts":1352820828168,"patch":[[{"diffs":[[0,"List"],[-1,"({\n                url: '/comments'\n            })"],[0,";\n  "]],"start1":6861,"start2":6861,"length1":58,"length2":8}]],"length":8929,"saved":false}
{"ts":1352820844525,"patch":[[{"diffs":[[0,"e: '_id'"],[1,",\n        urlRoot: '/shops'"],[0,"\n    });"]],"start1":359,"start2":359,"length1":16,"length2":43}]],"length":8956,"saved":false}
{"ts":1352820899618,"patch":[[{"diffs":[[0,"        data: {\n"],[1,"                    shop_id: view.id;\n"],[0,"                "]],"start1":8396,"start2":8396,"length1":32,"length2":70}]],"length":8994,"saved":false}
{"ts":1352820904706,"patch":[[{"diffs":[[0," view.id"],[-1,";"],[0,"\n       "]],"start1":8440,"start2":8440,"length1":17,"length2":16}]],"length":8993,"saved":false}
{"ts":1352820966900,"patch":[[{"diffs":[[0,"    "],[-1,"this.comments.create({\n                data: {\n                    shop_id: view.id\n                },"],[1,"var comment = $('section#comments textarea').val();\n            this.comments.create({}, {"],[0,"\n   "]],"start1":8361,"start2":8361,"length1":110,"length2":98}]],"length":8981,"saved":false}
{"ts":1352820972757,"patch":[[{"diffs":[[0,"ea').val();\n"],[1,"            console.log(comment);\n"],[0,"            "]],"start1":8405,"start2":8405,"length1":24,"length2":58}]],"length":9015,"saved":false}
{"ts":1352820989485,"patch":[[{"diffs":[[0,"create({"],[1," shop_id: this.id "],[0,"}, {\n   "]],"start1":8477,"start2":8477,"length1":16,"length2":34}]],"length":9033,"saved":false}
{"ts":1352821020915,"patch":[[{"diffs":[[0,"nction(d) {\n"],[1,"                    view.id = id;\n"],[0,"            "]],"start1":8190,"start2":8190,"length1":24,"length2":58}]],"length":9067,"saved":false}
{"ts":1352821041952,"patch":[[{"diffs":[[0,"t);\n            "],[1,"console.log(this.id)\n            /*"],[0,"this.comments.cr"]],"start1":8481,"start2":8481,"length1":32,"length2":67},{"diffs":[[0,"\n            });"],[1,"*/"],[0,"\n        }\n    }"]],"start1":8667,"start2":8667,"length1":32,"length2":34}]],"length":9104,"saved":false}
{"ts":1352821066133,"patch":[[{"diffs":[[0,"                "],[1,"view.postComment();"],[0,"\n            });"]],"start1":7003,"start2":7003,"length1":32,"length2":51}]],"length":9123,"saved":false}
{"ts":1352821069525,"patch":[[{"diffs":[[0,"    \n           "],[1," //"],[0," this.comments.f"]],"start1":7953,"start2":7953,"length1":32,"length2":35}]],"length":9126,"saved":false}
{"ts":1352821100039,"patch":[[{"diffs":[[0,"   \n            "],[1,"//"],[0,"});\n        },\n "]],"start1":8008,"start2":8008,"length1":32,"length2":34}]],"length":9128,"saved":false}
{"ts":1352821141411,"patch":[[{"diffs":[[0,"e: function() {\n"],[1,"            var view = this;\n"],[0,"            this"]],"start1":6833,"start2":6833,"length1":32,"length2":61}]],"length":9157,"saved":false}
{"ts":1352821161782,"patch":[[{"diffs":[[0,"            "],[-1,"/*"],[0,"this.comment"]],"start1":8571,"start2":8571,"length1":26,"length2":24}]],"length":9155,"saved":false}
{"ts":1352821163070,"patch":[[{"diffs":[[0,"\n            });"],[-1,"*/"],[0,"\n        }\n    }"]],"start1":8718,"start2":8718,"length1":34,"length2":32}]],"length":9153,"saved":false}
{"ts":1352821747345,"patch":[[{"diffs":[[0,"        "],[-1," //"],[0," this.co"]],"start1":7990,"start2":7990,"length1":19,"length2":16},{"diffs":[[0,"        "],[-1,"//"],[0,"});\n    "]],"start1":8042,"start2":8042,"length1":18,"length2":16}]],"length":9148,"saved":false}
{"ts":1352821786952,"patch":[[{"diffs":[[0,"                "],[1,"data: {\n                    shop_id: this.id\n                }"],[0,"\n            });"]],"start1":8021,"start2":8021,"length1":32,"length2":94}]],"length":9210,"saved":false}
{"ts":1352821799213,"patch":[[{"diffs":[[0,"this.id\n"],[1,"                },\n                success: function() {\n"],[0,"        "]],"start1":8074,"start2":8074,"length1":16,"length2":73}]],"length":9267,"saved":false}
{"ts":1352821808453,"patch":[[{"diffs":[[0,"ccess: function("],[1,"a"],[0,") {\n"],[1,"                    console.log(a)\n"],[0,"                "]],"start1":8119,"start2":8119,"length1":36,"length2":72}]],"length":9303,"saved":false}
{"ts":1352822171644,"patch":[[{"diffs":[[0,"();\n"],[-1,"            console.log(comment);\n            console.log(this.id)\n"],[0,"    "]],"start1":8650,"start2":8650,"length1":75,"length2":8}]],"length":9236,"saved":false}
{"ts":1352822214548,"patch":[[{"diffs":[[0,"        "],[-1,"console.log(a)"],[1,"view.comments.models.forEach(function() {\n                    });"],[0,"\n       "]],"start1":8152,"start2":8152,"length1":30,"length2":81}]],"length":9287,"saved":false}
{"ts":1352822243906,"patch":[[{"diffs":[[0,"orEach(function("],[-1,") {"],[1,"item) {\n                        dust.render('comment-item', item, function(err, html) {\n                        });"],[0,"\n               "]],"start1":8182,"start2":8182,"length1":35,"length2":147}]],"length":9399,"saved":false}
{"ts":1352822277714,"patch":[[{"diffs":[[0,"on(err, html) {\n"],[1,"                            $('sectiomn#comments').find('ul').empty();\n"],[0,"                "]],"start1":8270,"start2":8270,"length1":32,"length2":103}]],"length":9470,"saved":false}
{"ts":1352822294034,"patch":[[{"diffs":[[0,"nction(a) {\n"],[1,"                    $('sectiomn#comments').find('ul').empty();\n"],[0,"            "]],"start1":8128,"start2":8128,"length1":24,"length2":87},{"diffs":[[0,"    "],[-1,"$('sectiomn#comments').find('ul').empty();"],[0,"\n   "]],"start1":8373,"start2":8373,"length1":50,"length2":8}]],"length":9491,"saved":false}
{"ts":1352822312939,"patch":[[{"diffs":[[0,"('sectio"],[-1,"m"],[0,"n#commen"]],"start1":8161,"start2":8161,"length1":17,"length2":16},{"diffs":[[0,"                "],[1,"$('section#comments').find('ul')        "],[0,"\n               "]],"start1":8360,"start2":8360,"length1":32,"length2":72}]],"length":9530,"saved":false}
{"ts":1352822324829,"patch":[[{"diffs":[[0,"nd('ul')"],[-1,"        "],[1,".prepend(html)"],[0,"\n       "]],"start1":8400,"start2":8400,"length1":24,"length2":30}]],"length":9536,"saved":false}
{"ts":1352822354267,"patch":[[{"diffs":[[0," this.id"],[1,", comment: comment"],[0," }, {\n  "]],"start1":8997,"start2":8997,"length1":16,"length2":34}]],"length":9554,"saved":false}
{"ts":1352822680713,"patch":[[{"diffs":[[0,"     urlRoot: '/"],[-1,"shop"],[1,"comment"],[0,"s'\n    });\n\n    "]],"start1":372,"start2":372,"length1":36,"length2":39}]],"length":9557,"saved":false}
{"ts":1352822754858,"patch":[[{"diffs":[[0,"'comment"],[-1,"-"],[1,"_"],[0,"item', i"]],"start1":8307,"start2":8307,"length1":17,"length2":17}]],"length":9557,"saved":false}
{"ts":1352822862023,"patch":[[{"diffs":[[0,"ccess: function("],[-1,") {"],[1,"a, b) {\n                    console.log(a)\n                    console.log(b)"],[0,"\n               "]],"start1":9050,"start2":9050,"length1":35,"length2":109}]],"length":9631,"saved":false}
{"ts":1352823167434,"patch":[[{"diffs":[[0,"nction(a) {\n"],[1,"                    console.log('commentsss')\n                    console.log(a)\n"],[0,"            "]],"start1":8131,"start2":8131,"length1":24,"length2":105}]],"length":9712,"saved":false}
{"ts":1352823203728,"patch":[[{"diffs":[[0,"ment_item', item"],[1,".toJSON()"],[0,", function(err, "]],"start1":8392,"start2":8392,"length1":32,"length2":41}]],"length":9721,"saved":false}
{"ts":1352823334054,"patch":[[{"diffs":[[0,"    "],[-1,"view.postComment();"],[1,"if (app.loggedIn) {\n                    view.postComment();\n                } else {\n                    $('section#login').fadeIn();\n                }"],[0,"\n   "]],"start1":7047,"start2":7047,"length1":27,"length2":159}]],"length":9853,"saved":false}
{"ts":1352825484394,"patch":[[{"diffs":[[0,"ea').val();\n"],[1,"            var user_photo = \n"],[0,"            "]],"start1":9167,"start2":9167,"length1":24,"length2":54},{"diffs":[[0," comment"],[1,", user_photo: user_photo"],[0," }, {\n  "]],"start1":9270,"start2":9270,"length1":16,"length2":40}]],"length":9907,"saved":false}
{"ts":1352825516362,"patch":[[{"diffs":[[0,"photo = "],[1,"$(\".account img\").attr('src')"],[0,"\n       "]],"start1":9200,"start2":9200,"length1":16,"length2":45}]],"length":9936,"saved":false}
{"ts":1352825518392,"patch":[[{"diffs":[[0,"r('src')"],[1,";"],[0,"\n       "]],"start1":9229,"start2":9229,"length1":16,"length2":17}]],"length":9937,"saved":false}
{"ts":1352825566473,"patch":[[{"diffs":[[0,"ttr('src');\n"],[1,"            var user_name = $(\".account p\").text();\n"],[0,"            "]],"start1":9227,"start2":9227,"length1":24,"length2":76}]],"length":9989,"saved":false}
{"ts":1352825570675,"patch":[[{"diffs":[[0,"var "],[-1,"user_name"],[1,"by"],[0," = $"]],"start1":9251,"start2":9251,"length1":17,"length2":10}]],"length":9982,"saved":false}
{"ts":1352825585797,"patch":[[{"diffs":[[0,"er_photo"],[1,", by: by"],[0," }, {\n  "]],"start1":9369,"start2":9369,"length1":16,"length2":24}]],"length":9990,"saved":false}
